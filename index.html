<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SalesFun ‚Äî Real Estate CRM</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, orderBy, onSnapshot, serverTimestamp, where } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAz-44QWWH4lcXu9I7Xs56RCsjSbmSHNuo",
    authDomain: "fir-config-9023d.firebaseapp.com",
    projectId: "fir-config-9023d",
    storageBucket: "fir-config-9023d.firebasestorage.app",
    messagingSenderId: "178665965729",
    appId: "1:178665965729:web:57fcb0f607a1420c8e08e0"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window._db = db;
  window._firebase = { collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, orderBy, onSnapshot, serverTimestamp, where };
  window._dbReady = true;

  window.addEventListener('DOMContentLoaded', () => {
    initApp();
  });
</script>

<style>
:root {
  --bg:#0f0e0c; --bg2:#161410; --bg3:#1e1b16; --bg4:#26221b; --bg5:#2e2920;
  --border:rgba(255,220,140,0.08); --border2:rgba(255,220,140,0.16);
  --gold:#d4a843; --gold2:#f0c96a; --gold-dim:rgba(212,168,67,0.12); --gold-glow:rgba(212,168,67,0.22);
  --text:#f0ead8; --text2:#9a9080; --text3:#5a5045;
  --green:#4caf7d; --green-dim:rgba(76,175,125,0.12);
  --red:#e05555; --red-dim:rgba(224,85,85,0.12);
  --blue:#6ba3d6; --blue-dim:rgba(107,163,214,0.12);
  --orange:#e8924a; --orange-dim:rgba(232,146,74,0.12);
  --purple:#a78bfa; --purple-dim:rgba(167,139,250,0.12);
  --teal:#2dd4bf; --teal-dim:rgba(45,212,191,0.12);
  --r:10px; --r-sm:7px;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column;}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar{height:54px;background:var(--bg2);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 18px;gap:14px;flex-shrink:0;z-index:100;}
.logo{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;color:var(--gold2);letter-spacing:.02em;display:flex;align-items:center;gap:8px;cursor:pointer;flex-shrink:0;}
.logo-icon{width:30px;height:30px;background:linear-gradient(135deg,var(--gold),var(--gold2));border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:14px;color:#0f0e0c;font-weight:700;}
.top-search{flex:1;max-width:340px;margin:0 10px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;display:flex;align-items:center;padding:0 12px;gap:8px;height:34px;}
.top-search input{background:none;border:none;outline:none;color:var(--text);font-family:inherit;font-size:13px;width:100%;}
.top-search input::placeholder{color:var(--text3);}
.top-right{margin-left:auto;display:flex;align-items:center;gap:8px;}
.t-btn{height:32px;padding:0 14px;background:var(--bg3);border:1px solid var(--border);color:var(--text2);font-family:inherit;font-size:12px;font-weight:500;border-radius:7px;cursor:pointer;display:flex;align-items:center;gap:6px;transition:all .2s;text-decoration:none;}
.t-btn:hover{border-color:var(--border2);color:var(--text);background:var(--bg4);}
.t-btn.gold{background:var(--gold-dim);border-color:rgba(212,168,67,.3);color:var(--gold);}
.t-btn.gold:hover{background:var(--gold-glow);}
.t-btn.portal{background:var(--teal-dim);border-color:rgba(45,212,191,.3);color:var(--teal);}
.t-btn.portal:hover{background:rgba(45,212,191,.2);}
.notif-btn{width:32px;height:32px;background:var(--bg3);border:1px solid var(--border);border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text2);transition:all .2s;position:relative;}
.notif-badge{position:absolute;top:-3px;right:-3px;width:15px;height:15px;background:var(--red);border-radius:50%;font-size:8px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center;border:2px solid var(--bg2);}
.avatar{width:32px;height:32px;background:linear-gradient(135deg,#8b4513,var(--gold));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;cursor:pointer;flex-shrink:0;}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.app-body{flex:1;display:flex;overflow:hidden;}

/* ‚îÄ‚îÄ SIDENAV ‚îÄ‚îÄ */
.sidenav{width:220px;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:14px 10px;gap:2px;flex-shrink:0;overflow-y:auto;}
.sidenav::-webkit-scrollbar{width:0;}
.nav-section-label{font-size:10px;font-weight:600;letter-spacing:.1em;color:var(--text3);text-transform:uppercase;padding:10px 10px 4px;margin-top:4px;}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 10px;border-radius:8px;cursor:pointer;color:var(--text2);font-size:13px;font-weight:500;transition:all .15s;position:relative;}
.nav-item:hover{background:var(--bg3);color:var(--text);}
.nav-item.active{background:var(--gold-dim);color:var(--gold);}
.nav-item.active::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:3px;height:20px;background:var(--gold);border-radius:0 2px 2px 0;}
.nav-item svg{flex-shrink:0;}
.nav-badge{margin-left:auto;font-size:10px;font-weight:700;background:var(--bg4);color:var(--text2);padding:1px 6px;border-radius:20px;min-width:18px;text-align:center;}
.nav-badge.hot{background:var(--red-dim);color:var(--red);}
.nav-badge.new{background:var(--green-dim);color:var(--green);}
.nav-badge.prop{background:var(--purple-dim);color:var(--purple);}
.nav-divider{height:1px;background:var(--border);margin:8px 0;}
.nav-spacer{flex:1;}
.nav-agent-card{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:10px;margin-top:4px;}
.nac-top{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.nac-avatar{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,#8b4513,var(--gold));display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;flex-shrink:0;}
.nac-name{font-size:12px;font-weight:600;color:var(--text);}
.nac-role{font-size:10px;color:var(--text3);}
.nac-stats{display:flex;gap:8px;}
.nac-stat{flex:1;text-align:center;}
.nac-stat-val{font-size:14px;font-weight:700;color:var(--gold);}
.nac-stat-lbl{font-size:9px;color:var(--text3);}

/* ‚îÄ‚îÄ VIEWS ‚îÄ‚îÄ */
.main{flex:1;overflow-y:auto;display:flex;flex-direction:column;min-width:0;}
.main::-webkit-scrollbar{width:6px;}
.main::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px;}
.view{display:none;flex:1;flex-direction:column;overflow:hidden;}
.view.active{display:flex;}
.page-header{padding:20px 24px 0;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.page-title h1{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:700;color:var(--text);letter-spacing:.01em;}
.page-title p{font-size:13px;color:var(--text2);margin-top:2px;}
.page-actions{display:flex;gap:8px;align-items:center;}

/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
.dash-content{padding:20px 24px;flex:1;overflow-y:auto;}
.dash-content::-webkit-scrollbar{width:6px;}
.dash-content::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px;}
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px;}
.stat-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);padding:16px;transition:border-color .2s;cursor:default;animation:fadeUp .4s ease forwards;opacity:0;}
.stat-card:hover{border-color:var(--border2);}
.stat-card:nth-child(1){animation-delay:.05s;}
.stat-card:nth-child(2){animation-delay:.1s;}
.stat-card:nth-child(3){animation-delay:.15s;}
.stat-card:nth-child(4){animation-delay:.2s;}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.sc-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.sc-icon{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;}
.sc-val{font-size:28px;font-weight:700;color:var(--text);letter-spacing:-.5px;font-family:'Cormorant Garamond',serif;}
.sc-lbl{font-size:12px;color:var(--text2);margin-top:2px;}
.dash-grid{display:grid;grid-template-columns:1fr 340px;gap:14px;}
.dash-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;}
.dc-header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.dc-title{font-size:14px;font-weight:600;color:var(--text);}
.dc-subtitle{font-size:11px;color:var(--text3);}
.dc-action{font-size:12px;color:var(--gold);cursor:pointer;text-decoration:none;}
.dc-action:hover{text-decoration:underline;}

/* pipeline */
.pipeline-cols{display:flex;gap:0;}
.pipeline-col{flex:1;border-right:1px solid var(--border);display:flex;flex-direction:column;}
.pipeline-col:last-child{border-right:none;}
.pc-header{padding:10px 12px;background:var(--bg3);border-bottom:1px solid var(--border);}
.pc-name{font-size:11px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.06em;}
.pc-count{font-size:10px;color:var(--text3);margin-top:1px;}
.pc-leads{padding:8px;display:flex;flex-direction:column;gap:6px;overflow-y:auto;max-height:200px;}
.pc-leads::-webkit-scrollbar{width:3px;}
.pc-leads::-webkit-scrollbar-thumb{background:var(--bg4);}
.lead-mini{background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:8px;cursor:pointer;transition:all .15s;}
.lead-mini:hover{border-color:var(--border2);transform:translateY(-1px);}
.lm-name{font-size:12px;font-weight:600;color:var(--text);}
.lm-prop{font-size:11px;color:var(--text3);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.lm-budget{font-size:11px;color:var(--gold);font-weight:600;margin-top:4px;}

.activity-list{padding:10px 0;}
.act-item{display:flex;gap:12px;padding:10px 16px;border-bottom:1px solid var(--border);transition:background .15s;}
.act-item:last-child{border-bottom:none;}
.act-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:5px;}
.act-text{font-size:12px;color:var(--text2);line-height:1.5;}
.act-text strong{color:var(--text);}
.act-time{font-size:10px;color:var(--text3);margin-top:2px;}

.fu-dash-list{padding:8px 0;}
.fu-dash-item{display:flex;align-items:center;gap:10px;padding:10px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;}
.fu-dash-item:hover{background:var(--bg3);}
.fu-dash-item:last-child{border-bottom:none;}
.fu-dash-av{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0;background:var(--bg4);color:var(--text2);}
.fu-dash-info{flex:1;min-width:0;}
.fu-dash-name{font-size:13px;font-weight:600;color:var(--text);}
.fu-dash-note{font-size:11px;color:var(--text3);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.fu-dash-time{font-size:11px;font-weight:600;padding:3px 8px;border-radius:20px;flex-shrink:0;}
.fu-dash-time.urgent{background:var(--red-dim);color:var(--red);}
.fu-dash-time.today{background:var(--orange-dim);color:var(--orange);}

/* ‚îÄ‚îÄ LEADS VIEW ‚îÄ‚îÄ */
.leads-content{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.leads-toolbar{padding:14px 24px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border);flex-shrink:0;flex-wrap:wrap;}
.filter-chip{padding:5px 12px;border-radius:20px;font-size:12px;font-weight:500;background:var(--bg3);border:1px solid var(--border);color:var(--text2);cursor:pointer;transition:all .15s;white-space:nowrap;}
.filter-chip:hover{border-color:var(--border2);color:var(--text);}
.filter-chip.active{background:var(--gold-dim);border-color:rgba(212,168,67,.3);color:var(--gold);}
.leads-table-wrap{flex:1;overflow-y:auto;padding:0 24px 20px;}
.leads-table-wrap::-webkit-scrollbar{width:6px;}
.leads-table-wrap::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px;}
table{width:100%;border-collapse:collapse;margin-top:14px;}
thead th{font-size:11px;font-weight:600;letter-spacing:.07em;text-transform:uppercase;color:var(--text3);padding:8px 12px;text-align:left;border-bottom:1px solid var(--border);white-space:nowrap;}
tbody tr{border-bottom:1px solid var(--border);transition:background .15s;cursor:pointer;}
tbody tr:hover{background:var(--bg2);}
tbody td{padding:12px 12px;font-size:13px;color:var(--text2);vertical-align:middle;}
.td-name{color:var(--text);font-weight:600;}
.td-phone{font-family:'JetBrains Mono',monospace;font-size:12px;}
.td-budget{color:var(--gold);font-weight:600;}
.td-actions{display:flex;gap:6px;}
.row-btn{height:26px;padding:0 10px;background:var(--bg3);border:1px solid var(--border);color:var(--text3);font-family:inherit;font-size:11px;border-radius:6px;cursor:pointer;transition:all .15s;white-space:nowrap;}
.row-btn:hover{border-color:var(--border2);color:var(--text);}
.row-btn.del:hover{border-color:rgba(224,85,85,.4);color:var(--red);}

/* ‚îÄ‚îÄ FOLLOW-UPS VIEW ‚îÄ‚îÄ */
.fu-content{flex:1;display:flex;overflow:hidden;}
.fu-sidebar{width:260px;border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;}
.fu-main-area{flex:1;overflow-y:auto;padding:20px 24px;}
.fu-main-area::-webkit-scrollbar{width:6px;}
.fu-main-area::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px;}
.fu-cal-header{padding:14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.fu-cal-title{font-size:13px;font-weight:600;}
.mini-cal{padding:12px;}
.mini-cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;text-align:center;}
.mcg-day-name{font-size:9px;color:var(--text3);padding:2px 0;font-weight:600;}
.mcg-day{font-size:11px;padding:5px 3px;border-radius:5px;cursor:pointer;color:var(--text2);transition:all .15s;}
.mcg-day:hover{background:var(--bg3);color:var(--text);}
.mcg-day.today{background:var(--gold-dim);color:var(--gold);font-weight:700;}
.fu-type-list{padding:10px;border-top:1px solid var(--border);}
.fu-type-item{display:flex;align-items:center;gap:8px;padding:7px 8px;border-radius:7px;cursor:pointer;transition:background .15s;font-size:12px;color:var(--text2);}
.fu-type-item:hover{background:var(--bg3);color:var(--text);}
.fu-type-item.active{background:var(--gold-dim);color:var(--gold);}
.fu-type-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.fu-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);padding:16px;margin-bottom:12px;cursor:pointer;transition:all .2s;animation:fadeUp .3s ease forwards;opacity:0;}
.fu-card:hover{border-color:var(--border2);}
.fu-card-top{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
.fu-card-avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;flex-shrink:0;background:var(--bg4);color:var(--text2);}
.fu-card-info{flex:1;min-width:0;}
.fu-card-name{font-size:14px;font-weight:600;color:var(--text);}
.fu-card-sub{font-size:12px;color:var(--text3);margin-top:1px;}
.fu-card-badges{display:flex;gap:6px;align-items:center;flex-shrink:0;}
.fu-body{background:var(--bg3);border-radius:7px;padding:10px;font-size:12px;color:var(--text2);line-height:1.6;margin-bottom:10px;}
.fu-footer{display:flex;align-items:center;gap:8px;}
.fu-action-btn{flex:1;height:30px;border-radius:7px;border:1px solid var(--border);background:var(--bg3);color:var(--text2);font-family:inherit;font-size:11px;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:5px;transition:all .15s;}
.fu-action-btn:hover{border-color:var(--border2);color:var(--text);}
.fu-action-btn.primary{background:var(--gold-dim);border-color:rgba(212,168,67,.3);color:var(--gold);}
.fu-action-btn.primary:hover{background:var(--gold-glow);}
.fu-action-btn.danger{background:var(--red-dim);border-color:rgba(224,85,85,.3);color:var(--red);}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PROPERTIES VIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.props-content{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.props-toolbar{padding:14px 24px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border);flex-shrink:0;flex-wrap:wrap;}
.props-table-wrap{flex:1;overflow-y:auto;padding:0 24px 20px;}
.props-table-wrap::-webkit-scrollbar{width:6px;}
.props-table-wrap::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px;}

/* Property card grid */
.props-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;padding:20px 24px;}
.prop-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;transition:all .2s;animation:fadeUp .35s ease forwards;opacity:0;cursor:pointer;}
.prop-card:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,0,0,.3);}
.prop-card:nth-child(1){animation-delay:.05s;}
.prop-card:nth-child(2){animation-delay:.1s;}
.prop-card:nth-child(3){animation-delay:.15s;}
.prop-card:nth-child(4){animation-delay:.2s;}
.prop-card:nth-child(5){animation-delay:.25s;}
.prop-card:nth-child(6){animation-delay:.3s;}
.prop-card-img{height:140px;background:var(--bg3);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;}
.prop-card-img-bg{position:absolute;inset:0;opacity:.07;}
.prop-card-img-icon{font-size:42px;position:relative;z-index:1;}
.prop-card-img-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(15,14,12,.8),transparent);z-index:2;}
.prop-card-img-badges{position:absolute;top:10px;left:10px;z-index:3;display:flex;gap:6px;flex-wrap:wrap;}
.prop-card-img-price{position:absolute;bottom:10px;right:10px;z-index:3;font-size:15px;font-weight:700;color:var(--gold2);font-family:'Cormorant Garamond',serif;}
.prop-card-body{padding:14px;}
.prop-card-title{font-size:14px;font-weight:700;color:var(--text);margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.prop-card-sub{font-size:12px;color:var(--text3);margin-bottom:10px;display:flex;align-items:center;gap:4px;}
.prop-meta-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;}
.prop-meta{display:flex;align-items:center;gap:4px;font-size:11px;color:var(--text2);background:var(--bg3);border:1px solid var(--border);border-radius:5px;padding:3px 7px;}
.prop-supplier-row{display:flex;align-items:center;gap:8px;padding-top:10px;border-top:1px solid var(--border);}
.prop-supplier-av{width:28px;height:28px;border-radius:50%;background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:var(--text2);flex-shrink:0;}
.prop-supplier-info{flex:1;min-width:0;}
.prop-supplier-name{font-size:12px;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.prop-supplier-role{font-size:10px;color:var(--text3);}
.prop-card-actions{display:flex;gap:6px;}
.prop-action-btn{flex:1;height:28px;border-radius:6px;border:1px solid var(--border);background:var(--bg3);color:var(--text3);font-family:inherit;font-size:11px;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:4px;}
.prop-action-btn:hover{border-color:var(--border2);color:var(--text);}
.prop-action-btn.del:hover{border-color:rgba(224,85,85,.4);color:var(--red);background:var(--red-dim);}

/* ‚îÄ‚îÄ PUBLISH TOGGLE BUTTON ‚îÄ‚îÄ */
.pub-btn{flex:1;height:28px;border-radius:6px;border:1px solid var(--border);background:var(--bg3);font-family:inherit;font-size:10px;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:4px;}
.pub-btn.published{background:var(--green-dim);border-color:rgba(76,175,125,.35);color:var(--green);}
.pub-btn.published:hover{background:var(--red-dim);border-color:rgba(224,85,85,.3);color:var(--red);}
.pub-btn.draft{color:var(--text3);}
.pub-btn.draft:hover{background:var(--green-dim);border-color:rgba(76,175,125,.3);color:var(--green);}

/* Portal info bar */
.portal-banner{margin:14px 24px 0;background:var(--teal-dim);border:1px solid rgba(45,212,191,.2);border-radius:8px;padding:10px 14px;display:flex;align-items:center;gap:10px;flex-shrink:0;}
.portal-banner-dot{width:6px;height:6px;border-radius:50%;background:var(--teal);box-shadow:0 0 6px rgba(45,212,191,.6);animation:pulse 2s infinite;flex-shrink:0;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.4;}}
.portal-banner-text{font-size:12px;color:var(--teal);flex:1;}
.portal-banner-link{font-size:11px;color:var(--teal);font-weight:600;text-decoration:none;background:rgba(45,212,191,.15);border:1px solid rgba(45,212,191,.3);border-radius:5px;padding:3px 10px;white-space:nowrap;}
.portal-banner-link:hover{background:rgba(45,212,191,.25);}

/* View toggle */
.view-toggle{display:flex;background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:3px;gap:2px;}
.vt-btn{width:28px;height:26px;border-radius:5px;border:none;background:transparent;color:var(--text3);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;font-size:13px;}
.vt-btn.active{background:var(--bg4);color:var(--text);}

/* Property status colors */
.prop-avail{background:var(--green-dim);color:var(--green);border:1px solid rgba(76,175,125,.2);}
.prop-nego{background:var(--gold-dim);color:var(--gold);border:1px solid rgba(212,168,67,.2);}
.prop-sold{background:rgba(90,80,69,.3);color:var(--text3);border:1px solid var(--border);}
.prop-hold{background:var(--orange-dim);color:var(--orange);border:1px solid rgba(232,146,74,.2);}

/* ‚îÄ‚îÄ TAGS & BADGES ‚îÄ‚îÄ */
.tag{font-size:10px;font-weight:600;padding:2px 6px;border-radius:4px;}
.tag-hot{background:var(--red-dim);color:var(--red);}
.tag-warm{background:var(--orange-dim);color:var(--orange);}
.tag-cold{background:var(--blue-dim);color:var(--blue);}
.tag-vip{background:var(--gold-dim);color:var(--gold);}
.tag-new{background:var(--green-dim);color:var(--green);}
.status-pill{display:inline-flex;align-items:center;gap:5px;font-size:10px;font-weight:600;padding:3px 8px;border-radius:20px;}
.pill-new{background:var(--green-dim);color:var(--green);border:1px solid rgba(76,175,125,.2);}
.pill-contacted{background:var(--blue-dim);color:var(--blue);border:1px solid rgba(107,163,214,.2);}
.pill-site{background:var(--orange-dim);color:var(--orange);border:1px solid rgba(232,146,74,.2);}
.pill-nego{background:var(--gold-dim);color:var(--gold);border:1px solid rgba(212,168,67,.2);}
.pill-closed{background:var(--green-dim);color:var(--green);border:1px solid rgba(76,175,125,.2);}
.pill-lost{background:rgba(90,80,69,.3);color:var(--text3);border:1px solid var(--border);}

/* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:1000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.modal-overlay.open{display:flex;}
.modal{background:var(--bg2);border:1px solid var(--border2);border-radius:14px;width:580px;max-width:95vw;max-height:90vh;overflow-y:auto;animation:fadeUp .3s ease;}
.modal.wide{width:680px;}
.modal::-webkit-scrollbar{width:4px;}
.modal::-webkit-scrollbar-thumb{background:var(--bg4);}
.modal-header{padding:18px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--bg2);z-index:1;}
.modal-header h3{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;}
.modal-close{width:30px;height:30px;background:var(--bg3);border:1px solid var(--border);border-radius:7px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text2);transition:all .15s;}
.modal-close:hover{border-color:var(--border2);color:var(--text);}
.modal-body{padding:20px;}
.modal-section{margin-bottom:20px;}
.modal-section-title{font-size:11px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--text3);padding-bottom:10px;border-bottom:1px solid var(--border);margin-bottom:14px;display:flex;align-items:center;gap:7px;}
.form-row{margin-bottom:14px;}
.form-label{font-size:11px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.06em;margin-bottom:6px;display:block;}
.form-input,.form-select,.form-textarea{width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--text);font-family:inherit;font-size:13px;outline:none;transition:border-color .2s;}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:rgba(212,168,67,.4);}
.form-input::placeholder,.form-textarea::placeholder{color:var(--text3);}
.form-select option{background:var(--bg3);}
.form-textarea{resize:vertical;min-height:72px;line-height:1.5;}
.form-2col{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.form-3col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;}
.modal-footer{padding:14px 20px;border-top:1px solid var(--border);display:flex;gap:8px;justify-content:flex-end;align-items:center;}
.btn-cancel{padding:0 16px;height:34px;background:var(--bg3);border:1px solid var(--border);color:var(--text2);font-family:inherit;font-size:13px;border-radius:8px;cursor:pointer;transition:all .15s;}
.btn-cancel:hover{border-color:var(--border2);color:var(--text);}
.btn-save{padding:0 20px;height:34px;background:var(--gold);border:none;color:#000;font-family:inherit;font-size:13px;font-weight:700;border-radius:8px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px;}
.btn-save:hover{background:var(--gold2);transform:translateY(-1px);}
.btn-save:disabled{opacity:.5;cursor:not-allowed;transform:none;}

/* Publish checkbox in modal */
.publish-checkbox-wrap{display:flex;align-items:center;gap:10px;margin-right:auto;background:var(--green-dim);border:1px solid rgba(76,175,125,.25);border-radius:8px;padding:6px 12px;cursor:pointer;}
.publish-checkbox-wrap input[type=checkbox]{width:15px;height:15px;accent-color:var(--green);cursor:pointer;}
.publish-checkbox-label{font-size:12px;font-weight:600;color:var(--green);cursor:pointer;}
.publish-checkbox-sub{font-size:10px;color:var(--text3);}

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;color:var(--text3);gap:12px;flex:1;}
.empty-state-icon{font-size:52px;opacity:.4;}
.empty-state h3{font-size:18px;font-weight:600;color:var(--text2);}
.empty-state p{font-size:13px;text-align:center;max-width:320px;line-height:1.6;}

/* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
.loading{display:flex;align-items:center;justify-content:center;padding:40px;color:var(--text3);gap:10px;font-size:13px;}
.spinner{width:18px;height:18px;border:2px solid var(--bg4);border-top-color:var(--gold);border-radius:50%;animation:spin .7s linear infinite;flex-shrink:0;}
@keyframes spin{to{transform:rotate(360deg);}}

/* ‚îÄ‚îÄ DB STATUS ‚îÄ‚îÄ */
.db-status{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text3);}
.db-dot{width:6px;height:6px;border-radius:50%;background:var(--text3);}
.db-dot.connected{background:var(--green);box-shadow:0 0 6px rgba(76,175,125,.5);}
.db-dot.error{background:var(--red);}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{position:fixed;bottom:24px;right:24px;background:var(--bg2);border:1px solid rgba(212,168,67,.3);border-radius:10px;padding:12px 16px;z-index:9999;display:flex;align-items:center;gap:10px;font-size:13px;color:var(--text);transform:translateY(20px);opacity:0;transition:all .3s;pointer-events:none;min-width:220px;box-shadow:0 8px 30px rgba(0,0,0,.5);}
.toast.show{transform:translateY(0);opacity:1;}
.toast.success{border-color:rgba(76,175,125,.3);}
.toast.error{border-color:rgba(224,85,85,.3);}

/* Property detail modal */
.prop-detail-header{background:var(--bg3);padding:16px;border-radius:10px;margin-bottom:16px;display:flex;gap:14px;align-items:flex-start;}
.prop-detail-icon{width:56px;height:56px;border-radius:12px;background:var(--purple-dim);border:1px solid rgba(167,139,250,.2);display:flex;align-items:center;justify-content:center;font-size:26px;flex-shrink:0;}
.prop-detail-meta{flex:1;}
.prop-detail-title{font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:700;color:var(--text);}
.prop-detail-loc{font-size:13px;color:var(--text3);margin-top:3px;}
.prop-detail-price{font-size:22px;font-weight:700;color:var(--gold);font-family:'Cormorant Garamond',serif;margin-top:4px;}
.prop-info-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px;}
.prop-info-item{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:10px 12px;}
.prop-info-label{font-size:10px;color:var(--text3);font-weight:600;letter-spacing:.07em;text-transform:uppercase;margin-bottom:4px;}
.prop-info-value{font-size:13px;font-weight:600;color:var(--text);}

::-webkit-scrollbar{width:6px;height:6px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px;}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="logo" onclick="setView('dashboard')">
    <div class="logo-icon">P</div>
    SalesFun
  </div>
  <div class="top-search">
    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="color:var(--text3)"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <input type="text" id="globalSearch" placeholder="Search leads, properties‚Ä¶" oninput="handleSearch(this.value)">
  </div>
  <div class="top-right">
    <div class="db-status" id="dbStatus">
      <div class="db-dot" id="dbDot"></div>
      <span id="dbStatusText">Connecting‚Ä¶</span>
    </div>
    <div class="notif-btn" onclick="setView('followups')">
      <div class="notif-badge" id="todayFuBadge">0</div>
      <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
    </div>
    <button class="t-btn gold" onclick="openLeadModal()">
      <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      Add Lead
    </button>
    <div class="avatar">RK</div>
  </div>
</div>

<!-- BODY -->
<div class="app-body">

<!-- SIDENAV -->
<nav class="sidenav">
  <div class="nav-section-label">Overview</div>
  <div class="nav-item active" id="nav-dashboard" onclick="setView('dashboard')">
    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
    Dashboard
  </div>
  <div class="nav-section-label">Work</div>
  <div class="nav-item" id="nav-leads" onclick="setView('leads')">
    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
    Leads
    <span class="nav-badge hot" id="nav-leads-count">0</span>
  </div>
  <div class="nav-item" id="nav-followups" onclick="setView('followups')">
    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
    Follow-ups
    <span class="nav-badge hot" id="nav-fu-count">0</span>
  </div>
  <div class="nav-item" id="nav-properties" onclick="setView('properties')">
    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    Properties
    <span class="nav-badge prop" id="nav-props-count">0</span>
  </div>
  <div class="nav-spacer"></div>
  <div class="nav-agent-card">
    <div class="nac-top">
      <div class="nac-avatar">RK</div>
      <div><div class="nac-name">Your Name</div><div class="nac-role">Real Estate Agent</div></div>
    </div>
    <div class="nac-stats">
      <div class="nac-stat"><div class="nac-stat-val" id="stat-total">0</div><div class="nac-stat-lbl">Leads</div></div>
      <div class="nac-stat"><div class="nac-stat-val" id="stat-closed">0</div><div class="nac-stat-lbl">Closed</div></div>
      <div class="nac-stat"><div class="nac-stat-val" id="stat-hot">0</div><div class="nac-stat-lbl">Hot</div></div>
    </div>
  </div>
</nav>

<!-- MAIN -->
<div class="main">

<!-- ‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê -->
<div class="view active" id="view-dashboard">
  <div class="page-header">
    <div class="page-title">
      <h1 id="dashGreeting">Good morning ‚òÄÔ∏è</h1>
      <p id="dashDate">Loading‚Ä¶</p>
    </div>
  </div>
  <div class="dash-content">
    <div class="stats-row">
      <div class="stat-card">
        <div class="sc-top"><div class="sc-icon" style="background:var(--gold-dim)"><svg width="18" height="18" fill="none" stroke="var(--gold)" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg></div></div>
        <div class="sc-val" id="dash-total">‚Äî</div><div class="sc-lbl">Total Leads</div>
      </div>
      <div class="stat-card">
        <div class="sc-top"><div class="sc-icon" style="background:var(--purple-dim)"><svg width="18" height="18" fill="none" stroke="var(--purple)" stroke-width="2" viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div></div>
        <div class="sc-val" id="dash-props">‚Äî</div><div class="sc-lbl">Properties Listed</div>
      </div>
      <div class="stat-card">
        <div class="sc-top"><div class="sc-icon" style="background:var(--teal-dim)"><svg width="18" height="18" fill="none" stroke="var(--teal)" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg></div></div>
        <div class="sc-val" id="dash-published">‚Äî</div><div class="sc-lbl">Published to Portal</div>
      </div>
      <div class="stat-card">
        <div class="sc-top"><div class="sc-icon" style="background:var(--green-dim)"><svg width="18" height="18" fill="none" stroke="var(--green)" stroke-width="2" viewBox="0 0 24 24"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg></div></div>
        <div class="sc-val" id="dash-closed">‚Äî</div><div class="sc-lbl">Deals Closed</div>
      </div>
    </div>

    <div class="dash-grid">
      <div class="dash-card">
        <div class="dc-header">
          <div><div class="dc-title">Lead Pipeline</div><div class="dc-subtitle">Live from database</div></div>
          <a class="dc-action" onclick="setView('leads')">View all ‚Üí</a>
        </div>
        <div class="pipeline-cols" style="min-height:200px" id="pipelineCols">
          <div class="pipeline-col"><div class="pc-header"><div class="pc-name" style="color:var(--blue)">New</div><div class="pc-count" id="pc-new">0 leads</div></div><div class="pc-leads" id="pc-leads-new"><div class="loading"><div class="spinner"></div></div></div></div>
          <div class="pipeline-col"><div class="pc-header"><div class="pc-name" style="color:var(--orange)">Site Visit</div><div class="pc-count" id="pc-site">0 leads</div></div><div class="pc-leads" id="pc-leads-site"></div></div>
          <div class="pipeline-col"><div class="pc-header"><div class="pc-name" style="color:var(--gold)">Negotiation</div><div class="pc-count" id="pc-nego">0 leads</div></div><div class="pc-leads" id="pc-leads-nego"></div></div>
          <div class="pipeline-col"><div class="pc-header"><div class="pc-name" style="color:var(--green)">Closed</div><div class="pc-count" id="pc-closed">0 leads</div></div><div class="pc-leads" id="pc-leads-closed"></div></div>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;gap:14px">
        <div class="dash-card">
          <div class="dc-header">
            <div><div class="dc-title">Today's Follow-ups</div><div class="dc-subtitle" id="dash-fu-subtitle">Loading‚Ä¶</div></div>
            <a class="dc-action" onclick="setView('followups')">See all ‚Üí</a>
          </div>
          <div id="dash-fu-list" class="fu-dash-list"><div class="loading"><div class="spinner"></div>Loading‚Ä¶</div></div>
        </div>
        <div class="dash-card">
          <div class="dc-header"><div class="dc-title">Quick Add Lead</div></div>
          <div style="padding:14px">
            <div style="display:flex;gap:8px;margin-bottom:8px">
              <input class="form-input" style="flex:1" id="quick-name" placeholder="Full name">
              <input class="form-input" style="flex:1" id="quick-phone" placeholder="+91 phone">
            </div>
            <div style="display:flex;gap:8px">
              <input class="form-input" style="flex:1" id="quick-budget" placeholder="Budget (e.g. ‚Çπ1.5 Cr)">
              <button class="btn-save" style="flex-shrink:0" onclick="quickAddLead()">Add ‚Üí</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê LEADS VIEW ‚ïê‚ïê‚ïê -->
<div class="view" id="view-leads">
  <div class="page-header">
    <div class="page-title"><h1>Leads</h1><p id="leads-subtitle">Loading from database‚Ä¶</p></div>
    <div class="page-actions">
      <button class="t-btn gold" onclick="openLeadModal()">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Add Lead
      </button>
    </div>
  </div>
  <div class="leads-content">
    <div class="leads-toolbar" id="leadsToolbar">
      <div class="filter-chip active" data-filter="all">All (<span id="chip-all">0</span>)</div>
      <div class="filter-chip" data-filter="New">New (<span id="chip-new">0</span>)</div>
      <div class="filter-chip" data-filter="Contacted">Contacted (<span id="chip-contacted">0</span>)</div>
      <div class="filter-chip" data-filter="Site Visit">Site Visit (<span id="chip-site">0</span>)</div>
      <div class="filter-chip" data-filter="Negotiation">Negotiation (<span id="chip-nego">0</span>)</div>
      <div class="filter-chip" data-filter="Closed">Closed (<span id="chip-closed">0</span>)</div>
      <div class="filter-chip" data-filter="Lost">Lost (<span id="chip-lost">0</span>)</div>
    </div>
    <div class="leads-table-wrap">
      <table><thead><tr><th>Name</th><th>Phone</th><th>Budget</th><th>Interest</th><th>Source</th><th>Stage</th><th>Priority</th><th>Added</th><th>Actions</th></tr></thead>
      <tbody id="leadsTableBody"><tr><td colspan="9"><div class="loading"><div class="spinner"></div>Connecting‚Ä¶</div></td></tr></tbody></table>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê FOLLOW-UPS VIEW ‚ïê‚ïê‚ïê -->
<div class="view" id="view-followups">
  <div class="page-header">
    <div class="page-title"><h1>Follow-ups</h1><p id="fu-subtitle">Loading‚Ä¶</p></div>
    <div class="page-actions">
      <button class="t-btn gold" onclick="openFollowUpModal()">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Add Follow-up
      </button>
    </div>
  </div>
  <div class="fu-content">
    <div class="fu-sidebar">
      <div class="fu-cal-header"><span class="fu-cal-title" id="calMonth">February 2026</span></div>
      <div class="mini-cal" id="miniCal"></div>
      <div class="fu-type-list">
        <div class="fu-type-item active" data-type="all"><div class="fu-type-dot" style="background:var(--gold)"></div> All</div>
        <div class="fu-type-item" data-type="Call"><div class="fu-type-dot" style="background:var(--blue)"></div> Calls</div>
        <div class="fu-type-item" data-type="WhatsApp"><div class="fu-type-dot" style="background:var(--green)"></div> WhatsApp</div>
        <div class="fu-type-item" data-type="Site Visit"><div class="fu-type-dot" style="background:var(--orange)"></div> Site Visits</div>
        <div class="fu-type-item" data-type="Document"><div class="fu-type-dot" style="background:var(--red)"></div> Documents</div>
      </div>
    </div>
    <div class="fu-main-area" id="fuMainArea"><div class="loading"><div class="spinner"></div>Loading‚Ä¶</div></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PROPERTIES VIEW ‚ïê‚ïê‚ïê -->
<div class="view" id="view-properties">
  <div class="page-header">
    <div class="page-title">
      <h1>Property Listings</h1>
      <p id="props-subtitle">Manage supplier land & property inventory</p>
    </div>
    <div class="page-actions">
      <a class="t-btn portal" href="portal.html" target="_blank">
        üåê Live Portal
      </a>
      <div class="view-toggle">
        <button class="vt-btn active" id="vt-grid" onclick="setPropView('grid')" title="Grid">‚äû</button>
        <button class="vt-btn" id="vt-table" onclick="setPropView('table')" title="Table">‚ò∞</button>
      </div>
      <button class="t-btn gold" onclick="openPropertyModal()">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Add Property
      </button>
    </div>
  </div>

  <!-- Portal live banner -->
  <div class="portal-banner">
    <div class="portal-banner-dot"></div>
    <div class="portal-banner-text">
      <strong id="portal-published-count">0</strong> properties published to your public portal ‚Äî toggle üåê Publish on any card to show/hide it.
    </div>
    <a class="portal-banner-link" href="portal.html" target="_blank">Open Portal ‚Üí</a>
  </div>

  <div class="props-content">
    <div class="props-toolbar" id="propsToolbar">
      <div class="filter-chip active" data-pfilter="all">All (<span id="pchip-all">0</span>)</div>
      <div class="filter-chip" data-pfilter="Available">Available (<span id="pchip-avail">0</span>)</div>
      <div class="filter-chip" data-pfilter="Negotiation">Negotiation (<span id="pchip-nego">0</span>)</div>
      <div class="filter-chip" data-pfilter="On Hold">On Hold (<span id="pchip-hold">0</span>)</div>
      <div class="filter-chip" data-pfilter="Sold">Sold (<span id="pchip-sold">0</span>)</div>
      <div style="margin-left:auto;display:flex;gap:8px;">
        <select class="form-select" style="height:32px;padding:0 10px;font-size:12px;width:auto" id="propTypeFilter" onchange="renderProperties()">
          <option value="">All Types</option>
          <option>Agricultural Land</option><option>Residential Plot</option>
          <option>Commercial Plot</option><option>Apartment</option>
          <option>Villa / Bungalow</option><option>Industrial Land</option><option>Farm Land</option>
        </select>
      </div>
    </div>
    <div id="propsGridView" style="flex:1;overflow-y:auto;">
      <div class="props-grid" id="propsGrid"><div class="loading" style="grid-column:1/-1"><div class="spinner"></div>Loading‚Ä¶</div></div>
    </div>
    <div id="propsTableView" style="flex:1;overflow-y:auto;display:none;padding:0 24px 20px;">
      <table style="margin-top:14px">
        <thead><tr><th>Property Title</th><th>Type</th><th>Location</th><th>Area</th><th>Price</th><th>Supplier</th><th>Status</th><th>Portal</th><th>Actions</th></tr></thead>
        <tbody id="propsTableBody"><tr><td colspan="9"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
      </table>
    </div>
  </div>
</div>

</div><!-- end main -->
</div><!-- end app-body -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADD LEAD MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="leadModalOverlay" onclick="if(event.target===this)closeLeadModal()">
  <div class="modal">
    <div class="modal-header"><h3 id="leadModalTitle">Add New Lead</h3><div class="modal-close" onclick="closeLeadModal()">‚úï</div></div>
    <div class="modal-body">
      <input type="hidden" id="editLeadId">
      <div class="form-2col">
        <div class="form-row"><label class="form-label">Full Name *</label><input class="form-input" id="f-name" placeholder="e.g. Arjun Sharma"></div>
        <div class="form-row"><label class="form-label">Phone *</label><input class="form-input" id="f-phone" placeholder="+91 98800 12345"></div>
      </div>
      <div class="form-2col">
        <div class="form-row"><label class="form-label">Email</label><input class="form-input" id="f-email" placeholder="arjun@email.com"></div>
        <div class="form-row"><label class="form-label">Budget</label><input class="form-input" id="f-budget" placeholder="‚Çπ 1.5 Cr"></div>
      </div>
      <div class="form-2col">
        <div class="form-row"><label class="form-label">Property Type</label>
          <select class="form-select" id="f-proptype"><option value="">Select type</option><option>1BHK Apartment</option><option>2BHK Apartment</option><option>3BHK Apartment</option><option>Villa</option><option>Plot</option><option>Commercial</option></select>
        </div>
        <div class="form-row"><label class="form-label">Preferred Location</label><input class="form-input" id="f-location" placeholder="Andheri East, Mumbai"></div>
      </div>
      <div class="form-2col">
        <div class="form-row"><label class="form-label">Lead Source</label>
          <select class="form-select" id="f-source"><option value="">Select source</option><option>99acres</option><option>Housing.com</option><option>Instagram Ad</option><option>Referral</option><option>Walk-in</option></select>
        </div>
        <div class="form-row"><label class="form-label">Pipeline Stage</label>
          <select class="form-select" id="f-stage"><option value="New">New</option><option value="Contacted">Contacted</option><option value="Site Visit">Site Visit</option><option value="Negotiation">Negotiation</option><option value="Closed">Closed</option><option value="Lost">Lost</option></select>
        </div>
      </div>
      <div class="form-2col">
        <div class="form-row"><label class="form-label">Priority</label>
          <select class="form-select" id="f-priority"><option value="Normal">Normal</option><option value="Hot">üî• Hot</option><option value="Warm">Warm</option><option value="Cold">Cold</option><option value="VIP">‚≠ê VIP</option></select>
        </div>
        <div class="form-row"><label class="form-label">WhatsApp</label><input class="form-input" id="f-wa" placeholder="Same as phone if same"></div>
      </div>
      <div class="form-row"><label class="form-label">Notes</label><textarea class="form-textarea" id="f-notes" placeholder="Key preferences, requirements‚Ä¶"></textarea></div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeLeadModal()">Cancel</button>
      <button class="btn-save" id="saveLeadBtn" onclick="saveLead()"><svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Save Lead</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADD FOLLOW-UP MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="fuModalOverlay" onclick="if(event.target===this)closeFuModal()">
  <div class="modal">
    <div class="modal-header"><h3 id="fuModalTitle">Add Follow-up</h3><div class="modal-close" onclick="closeFuModal()">‚úï</div></div>
    <div class="modal-body">
      <input type="hidden" id="editFuId">
      <div class="form-2col">
        <div class="form-row"><label class="form-label">Lead *</label><select class="form-select" id="fu-leadId"><option value="">Select a lead</option></select></div>
        <div class="form-row"><label class="form-label">Type *</label>
          <select class="form-select" id="fu-type"><option value="Call">üìû Call</option><option value="WhatsApp">üí¨ WhatsApp</option><option value="Site Visit">üè† Site Visit</option><option value="Document">üìÑ Document</option><option value="Email">üìß Email</option></select>
        </div>
      </div>
      <div class="form-2col">
        <div class="form-row"><label class="form-label">Date *</label><input class="form-input" id="fu-date" type="date"></div>
        <div class="form-row"><label class="form-label">Time</label><input class="form-input" id="fu-time" type="time" value="10:00"></div>
      </div>
      <div class="form-row"><label class="form-label">Priority</label>
        <select class="form-select" id="fu-priority"><option value="Normal">Normal</option><option value="Urgent">üî¥ Urgent</option><option value="High">High</option></select>
      </div>
      <div class="form-row"><label class="form-label">Notes *</label><textarea class="form-textarea" id="fu-notes" placeholder="What to do in this follow-up‚Ä¶"></textarea></div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeFuModal()">Cancel</button>
      <button class="btn-save" id="saveFuBtn" onclick="saveFollowUp()"><svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Save</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADD PROPERTY MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="propModalOverlay" onclick="if(event.target===this)closePropModal()">
  <div class="modal wide">
    <div class="modal-header"><h3 id="propModalTitle">Add Property Listing</h3><div class="modal-close" onclick="closePropModal()">‚úï</div></div>
    <div class="modal-body">
      <input type="hidden" id="editPropId">
      <div class="modal-section">
        <div class="modal-section-title"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg> Property Details</div>
        <div class="form-row"><label class="form-label">Title *</label><input class="form-input" id="p-title" placeholder="e.g. Green Valley Agricultural Land, Pune"></div>
        <div class="form-2col">
          <div class="form-row"><label class="form-label">Type *</label>
            <select class="form-select" id="p-type"><option value="">Select type</option><option>Agricultural Land</option><option>Residential Plot</option><option>Commercial Plot</option><option>Apartment</option><option>Villa / Bungalow</option><option>Industrial Land</option><option>Farm Land</option></select>
          </div>
          <div class="form-row"><label class="form-label">Status</label>
            <select class="form-select" id="p-status"><option value="Available">üü¢ Available</option><option value="Negotiation">üü° Negotiation</option><option value="On Hold">üü† On Hold</option><option value="Sold">‚ö´ Sold</option></select>
          </div>
        </div>
        <div class="form-2col">
          <div class="form-row"><label class="form-label">Location *</label><input class="form-input" id="p-location" placeholder="e.g. Khed, Pune, Maharashtra"></div>
          <div class="form-row"><label class="form-label">Survey / Plot No.</label><input class="form-input" id="p-survey" placeholder="Survey No. 123/1A"></div>
        </div>
        <div class="form-3col">
          <div class="form-row"><label class="form-label">Area *</label><input class="form-input" id="p-area" placeholder="5 Acres / 2000 sqft"></div>
          <div class="form-row"><label class="form-label">Asking Price *</label><input class="form-input" id="p-price" placeholder="‚Çπ 45 Lakhs / Acre"></div>
          <div class="form-row"><label class="form-label">Price Per Unit</label><input class="form-input" id="p-ppu" placeholder="‚Çπ 450/sqft"></div>
        </div>
        <div class="form-2col">
          <div class="form-row"><label class="form-label">Zone</label>
            <select class="form-select" id="p-zone"><option value="">Select</option><option>Agricultural</option><option>Residential</option><option>Commercial</option><option>Industrial</option><option>NA Plot</option></select>
          </div>
          <div class="form-row"><label class="form-label">Facing</label>
            <select class="form-select" id="p-facing"><option value="">Select</option><option>East Facing</option><option>West Facing</option><option>North Facing</option><option>South Facing</option><option>North-East</option></select>
          </div>
        </div>
        <div class="form-row"><label class="form-label">Key Features</label><textarea class="form-textarea" id="p-features" placeholder="Water source, road access, electricity‚Ä¶" style="min-height:60px"></textarea></div>
        <div class="form-row"><label class="form-label">Description</label><textarea class="form-textarea" id="p-desc" placeholder="Detailed description, investment potential‚Ä¶"></textarea></div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Supplier / Owner</div>
        <div class="form-2col">
          <div class="form-row"><label class="form-label">Name *</label><input class="form-input" id="p-supplier-name" placeholder="e.g. Ramesh Patil"></div>
          <div class="form-row"><label class="form-label">Phone *</label><input class="form-input" id="p-supplier-phone" placeholder="+91 98765 43210"></div>
        </div>
        <div class="form-2col">
          <div class="form-row"><label class="form-label">Email</label><input class="form-input" id="p-supplier-email" placeholder="owner@email.com"></div>
          <div class="form-row"><label class="form-label">Supplier Type</label>
            <select class="form-select" id="p-supplier-type"><option value="Direct Owner">Direct Owner</option><option value="Broker / Agent">Broker / Agent</option><option value="Builder / Developer">Builder</option><option value="Bank / NPA">Bank / NPA</option></select>
          </div>
        </div>
        <div class="form-2col">
          <div class="form-row"><label class="form-label">Commission</label><input class="form-input" id="p-commission" placeholder="1% or ‚Çπ50,000 fixed"></div>
          <div class="form-row"><label class="form-label">Negotiable?</label>
            <select class="form-select" id="p-negotiable"><option value="Yes">Yes</option><option value="No">No ‚Äî Fixed</option><option value="Partially">Partially</option></select>
          </div>
        </div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg> Legal & Documents</div>
        <div class="form-3col">
          <div class="form-row"><label class="form-label">Title Status</label>
            <select class="form-select" id="p-title-status"><option value="">Unknown</option><option>Clear Title</option><option>Disputed</option><option>Joint Ownership</option></select>
          </div>
          <div class="form-row"><label class="form-label">7/12 Extract</label>
            <select class="form-select" id="p-712"><option value="">Not checked</option><option>Available</option><option>Not Available</option></select>
          </div>
          <div class="form-row"><label class="form-label">NA Order</label>
            <select class="form-select" id="p-na"><option value="">N/A</option><option>Available</option><option>Applied ‚Äî Pending</option><option>Required</option></select>
          </div>
        </div>
        <div class="form-row"><label class="form-label">Legal Notes</label><textarea class="form-textarea" id="p-legal" placeholder="Any encumbrance, disputes, pending dues‚Ä¶" style="min-height:60px"></textarea></div>
      </div>
    </div>
    <div class="modal-footer">
      <!-- PUBLISH CHECKBOX -->
      <label class="publish-checkbox-wrap" for="p-publish">
        <input type="checkbox" id="p-publish">
        <div>
          <div class="publish-checkbox-label">üåê Publish to Portal</div>
          <div class="publish-checkbox-sub">Visible on public website</div>
        </div>
      </label>
      <button class="btn-cancel" onclick="closePropModal()">Cancel</button>
      <button class="btn-save" id="savePropBtn" onclick="saveProperty()"><svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Save Property</button>
    </div>
  </div>
</div>

<!-- PROPERTY DETAIL MODAL -->
<div class="modal-overlay" id="propDetailOverlay" onclick="if(event.target===this)closePropDetail()">
  <div class="modal wide">
    <div class="modal-header"><h3 id="propDetailTitle">Property Details</h3><div class="modal-close" onclick="closePropDetail()">‚úï</div></div>
    <div class="modal-body" id="propDetailBody"></div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closePropDetail()">Close</button>
      <button class="btn-save" id="propDetailEditBtn">‚úèÔ∏è Edit Property</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"><span id="toastIcon">‚ú®</span><span id="toastMsg">Done!</span></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _leads=[], _followups=[], _properties=[];
let _currentFilter='all', _currentFuType='all', _currentPropFilter='all';
let _propViewMode='grid';
let _editingLeadId=null, _editingFuId=null, _editingPropId=null;
let _dbConnected=false;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initApp() {
  updateDate(); buildMiniCal();
  if(window._dbReady&&window._db){setDbStatus(true,'Connected');_dbConnected=true;loadLeadsFromDB();loadFollowUpsFromDB();loadPropertiesFromDB();}
  else{
    window.addEventListener('dbReady',()=>{setDbStatus(true,'Connected');_dbConnected=true;loadLeadsFromDB();loadFollowUpsFromDB();loadPropertiesFromDB();},{once:true});
    setTimeout(()=>{if(!_dbConnected){setDbStatus(false,'Failed');showToast('‚ö†Ô∏è Firebase connection failed','error');}},8000);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIRESTORE ‚Äî LEADS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadLeadsFromDB(){const{collection,onSnapshot,orderBy,query}=window._firebase;const q=query(collection(window._db,'leads'),orderBy('createdAt','desc'));onSnapshot(q,(snap)=>{_leads=snap.docs.map(d=>({id:d.id,...d.data()}));renderLeads();renderDashboard();updateNavCounts();});}
async function addLeadToDB(data){const{collection,addDoc,serverTimestamp}=window._firebase;await addDoc(collection(window._db,'leads'),{...data,createdAt:serverTimestamp()});}
async function updateLeadInDB(id,data){const{doc,updateDoc}=window._firebase;await updateDoc(doc(window._db,'leads',id),data);}
async function deleteLeadFromDB(id){const{doc,deleteDoc}=window._firebase;await deleteDoc(doc(window._db,'leads',id));}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIRESTORE ‚Äî FOLLOW-UPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadFollowUpsFromDB(){const{collection,onSnapshot,orderBy,query}=window._firebase;const q=query(collection(window._db,'followups'),orderBy('date','asc'));onSnapshot(q,(snap)=>{_followups=snap.docs.map(d=>({id:d.id,...d.data()}));renderFollowUps();renderDashboard();updateNavCounts();});}
async function addFollowUpToDB(data){const{collection,addDoc,serverTimestamp}=window._firebase;await addDoc(collection(window._db,'followups'),{...data,createdAt:serverTimestamp()});}
async function updateFollowUpInDB(id,data){const{doc,updateDoc}=window._firebase;await updateDoc(doc(window._db,'followups',id),data);}
async function deleteFollowUpFromDB(id){const{doc,deleteDoc}=window._firebase;await deleteDoc(doc(window._db,'followups',id));}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIRESTORE ‚Äî PROPERTIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadPropertiesFromDB(){const{collection,onSnapshot,orderBy,query}=window._firebase;const q=query(collection(window._db,'properties'),orderBy('createdAt','desc'));onSnapshot(q,(snap)=>{_properties=snap.docs.map(d=>({id:d.id,...d.data()}));renderProperties();renderDashboard();updateNavCounts();});}
async function addPropertyToDB(data){const{collection,addDoc,serverTimestamp}=window._firebase;await addDoc(collection(window._db,'properties'),{...data,createdAt:serverTimestamp()});}
async function updatePropertyInDB(id,data){const{doc,updateDoc}=window._firebase;await updateDoc(doc(window._db,'properties',id),data);}
async function deletePropertyFromDB(id){const{doc,deleteDoc}=window._firebase;await deleteDoc(doc(window._db,'properties',id));}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PUBLISH / UNPUBLISH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function togglePublish(id, currentState, event) {
  if(event) event.stopPropagation();
  const newState = !currentState;
  try {
    await updatePropertyInDB(id, { published: newState });
    showToast(newState ? 'üåê Published to portal!' : '‚ö´ Removed from portal', newState ? 'success' : 'info');
  } catch(e) {
    showToast('‚ùå Error: '+e.message, 'error');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ‚Äî LEADS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderLeads(filter){
  if(filter!==undefined)_currentFilter=filter;
  const tbody=document.getElementById('leadsTableBody');
  let list=_leads;
  if(_currentFilter!=='all')list=list.filter(l=>l.stage===_currentFilter);
  const counts={};_leads.forEach(l=>{counts[l.stage]=(counts[l.stage]||0)+1;});
  document.getElementById('chip-all').textContent=_leads.length;
  [['new','New'],['contacted','Contacted'],['site','Site Visit'],['nego','Negotiation'],['closed','Closed'],['lost','Lost']].forEach(([k,s])=>{const el=document.getElementById('chip-'+k);if(el)el.textContent=counts[s]||0;});
  document.getElementById('leads-subtitle').textContent=`${_leads.length} total ¬∑ ${counts['New']||0} new ¬∑ ${counts['Negotiation']||0} in negotiation`;
  if(list.length===0){tbody.innerHTML=`<tr><td colspan="9"><div class="empty-state"><div class="empty-state-icon">üë•</div><h3>No leads</h3><p>Click "Add Lead" to get started.</p></div></td></tr>`;return;}
  tbody.innerHTML=list.map(l=>{
    const pillClass={'New':'pill-new','Contacted':'pill-contacted','Site Visit':'pill-site','Negotiation':'pill-nego','Closed':'pill-closed','Lost':'pill-lost'}[l.stage]||'pill-new';
    const pBadge=l.priority==='Hot'?'<span class="tag tag-hot">üî• Hot</span>':l.priority==='VIP'?'<span class="tag tag-vip">‚≠ê VIP</span>':l.priority==='Warm'?'<span class="tag tag-warm">Warm</span>':l.priority==='Cold'?'<span class="tag tag-cold">Cold</span>':'‚Äî';
    const date=l.createdAt?.toDate?l.createdAt.toDate().toLocaleDateString('en-IN',{day:'2-digit',month:'short'}):'Just now';
    return `<tr><td><span class="td-name">${esc(l.name)}</span></td><td><span class="td-phone">${esc(l.phone||'‚Äî')}</span></td><td><span class="td-budget">${esc(l.budget||'‚Äî')}</span></td><td>${esc(l.location||'‚Äî')}</td><td>${esc(l.source||'‚Äî')}</td><td><span class="status-pill ${pillClass}">${l.stage}</span></td><td>${pBadge}</td><td style="font-size:11px;color:var(--text3)">${date}</td><td><div class="td-actions"><button class="row-btn" onclick="openLeadModal('${l.id}')">‚úèÔ∏è</button><button class="row-btn" onclick="openFollowUpModal(null,'${l.id}')">üìÖ FU</button><button class="row-btn del" onclick="confirmDeleteLead('${l.id}','${esc(l.name)}')">üóë</button></div></td></tr>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ‚Äî FOLLOW-UPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderFollowUps(type){
  if(type!==undefined)_currentFuType=type;
  const container=document.getElementById('fuMainArea');
  const today=new Date().toISOString().split('T')[0];
  let list=_followups.filter(f=>f.status!=='done');
  if(_currentFuType!=='all')list=list.filter(f=>f.type===_currentFuType);
  document.getElementById('fu-subtitle').textContent=`${list.filter(f=>f.date===today).length} due today ¬∑ ${list.length} pending`;
  if(list.length===0){container.innerHTML=`<div class="empty-state"><div class="empty-state-icon">üìÖ</div><h3>No follow-ups</h3><p>Add follow-up reminders to stay on top of every client.</p><button class="btn-save" onclick="openFollowUpModal()">+ Add Follow-up</button></div>`;return;}
  const groups={};list.forEach(f=>{const d=f.date||'No date';if(!groups[d])groups[d]=[];groups[d].push(f);});
  const sorted=Object.keys(groups).sort();
  container.innerHTML=sorted.map(date=>{
    const label=date===today?'üî¥ Today ‚Äî '+formatDate(date):date<today?'‚ö†Ô∏è Overdue ‚Äî '+formatDate(date):formatDate(date);
    return `<div style="font-size:12px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.08em;margin:${date===sorted[0]?'0':'16px'} 0 12px">${label}</div>${groups[date].map((f,i)=>renderFuCard(f,i)).join('')}`;
  }).join('');
}

function renderFuCard(f,idx){
  const lead=_leads.find(l=>l.id===f.leadId);
  const name=lead?lead.name:(f.leadName||'Unknown');
  const initials=name.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);
  const icon={Call:'üìû',WhatsApp:'üí¨','Site Visit':'üè†',Document:'üìÑ',Email:'üìß',Meeting:'ü§ù'}[f.type]||'üìã';
  const urgCls=f.priority==='Urgent'?'tag-hot':f.priority==='High'?'tag-warm':'';
  const ts=f.priority==='Urgent'?'background:var(--red-dim);color:var(--red)':'background:var(--orange-dim);color:var(--orange)';
  return `<div class="fu-card" style="animation-delay:${idx*.05}s"><div class="fu-card-top"><div class="fu-card-avatar">${initials}</div><div class="fu-card-info"><div class="fu-card-name">${esc(name)}</div><div class="fu-card-sub">${lead?esc(lead.budget||'')+(lead.location?' ¬∑ '+lead.location:''):'Lead not found'}</div></div><div class="fu-card-badges">${urgCls?`<span class="tag ${urgCls}">${f.priority}</span>`:''} ${f.time?`<span style="font-size:11px;font-weight:600;padding:3px 8px;border-radius:20px;${ts}">${f.time}</span>`:''}</div></div><div class="fu-body">${icon} <strong>${f.type}</strong> ‚Äî ${esc(f.notes||'No notes')}</div><div class="fu-footer"><button class="fu-action-btn primary" onclick="markFuDone('${f.id}')">‚úì Done</button><button class="fu-action-btn" onclick="openFollowUpModal('${f.id}')">‚úèÔ∏è Edit</button><button class="fu-action-btn danger" onclick="confirmDeleteFu('${f.id}')">üóë</button></div></div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ‚Äî PROPERTIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getPropIcon(type){const m={'Agricultural Land':'üåæ','Farm Land':'üåª','Residential Plot':'üè°','Commercial Plot':'üè¢','Apartment':'üè¨','Villa / Bungalow':'üè†','Industrial Land':'üè≠'};return m[type]||'üèóÔ∏è';}
function getPropStatusClass(status){return{Available:'prop-avail',Negotiation:'prop-nego','On Hold':'prop-hold',Sold:'prop-sold'}[status]||'prop-avail';}

function renderProperties(filter){
  if(filter!==undefined)_currentPropFilter=filter;
  const typeFilter=document.getElementById('propTypeFilter')?.value||'';
  let list=_properties;
  if(_currentPropFilter!=='all')list=list.filter(p=>p.status===_currentPropFilter);
  if(typeFilter)list=list.filter(p=>p.type===typeFilter);
  const counts={};_properties.forEach(p=>{counts[p.status]=(counts[p.status]||0)+1;});
  document.getElementById('pchip-all').textContent=_properties.length;
  document.getElementById('pchip-avail').textContent=counts['Available']||0;
  document.getElementById('pchip-nego').textContent=counts['Negotiation']||0;
  document.getElementById('pchip-hold').textContent=counts['On Hold']||0;
  document.getElementById('pchip-sold').textContent=counts['Sold']||0;
  document.getElementById('props-subtitle').textContent=`${_properties.length} listings ¬∑ ${counts['Available']||0} available`;
  const pubCount=_properties.filter(p=>p.published===true).length;
  const bannerEl=document.getElementById('portal-published-count');
  if(bannerEl)bannerEl.textContent=pubCount;
  if(_propViewMode==='grid')renderPropsGrid(list);
  else renderPropsTable(list);
}

function renderPropsGrid(list){
  const grid=document.getElementById('propsGrid');
  if(list.length===0){grid.innerHTML=`<div class="empty-state" style="grid-column:1/-1"><div class="empty-state-icon">üèóÔ∏è</div><h3>No properties</h3><p>Click "Add Property" to list your first property.</p><button class="btn-save" onclick="openPropertyModal()">+ Add Property</button></div>`;return;}
  grid.innerHTML=list.map((p,i)=>{
    const icon=getPropIcon(p.type);
    const stCls=getPropStatusClass(p.status);
    const supInit=(p.supplierName||'?').split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);
    const isPub=p.published===true;
    return `<div class="prop-card" style="animation-delay:${i*0.05}s" onclick="viewProperty('${p.id}')">
      <div class="prop-card-img">
        <div class="prop-card-img-bg" style="background:radial-gradient(circle at 30% 50%,var(--purple),transparent 70%)"></div>
        <div class="prop-card-img-icon">${icon}</div>
        <div class="prop-card-img-overlay"></div>
        <div class="prop-card-img-badges">
          <span class="status-pill ${stCls}">${p.status||'Available'}</span>
          ${isPub?`<span class="status-pill" style="background:var(--teal-dim);color:var(--teal);border:1px solid rgba(45,212,191,.2)">üåê Live</span>`:'<span class="status-pill" style="background:var(--bg4);color:var(--text3);border:1px solid var(--border)">‚ö´ Draft</span>'}
        </div>
        <div class="prop-card-img-price">${esc(p.price||'Price TBD')}</div>
      </div>
      <div class="prop-card-body">
        <div class="prop-card-title" title="${esc(p.title)}">${esc(p.title||'Untitled')}</div>
        <div class="prop-card-sub"><svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="color:var(--text3)"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>${esc(p.location||'TBD')}</div>
        <div class="prop-meta-row">
          ${p.type?`<div class="prop-meta">üè∑Ô∏è ${esc(p.type)}</div>`:''}
          ${p.area?`<div class="prop-meta">üìê ${esc(p.area)}</div>`:''}
          ${p.negotiable==='Yes'?`<div class="prop-meta" style="color:var(--green)">‚úì Negotiable</div>`:''}
        </div>
        <div class="prop-supplier-row">
          <div class="prop-supplier-av">${supInit}</div>
          <div class="prop-supplier-info"><div class="prop-supplier-name">${esc(p.supplierName||'‚Äî')}</div><div class="prop-supplier-role">${esc(p.supplierType||'Owner')}</div></div>
        </div>
        <div class="prop-card-actions" style="margin-top:10px">
          <button class="pub-btn ${isPub?'published':'draft'}" onclick="togglePublish('${p.id}',${isPub},event)" title="${isPub?'Click to unpublish':'Click to publish to portal'}">
            ${isPub?'üåê Live on Portal':'‚ö´ Publish to Portal'}
          </button>
        </div>
        <div class="prop-card-actions" style="margin-top:6px">
          <button class="prop-action-btn" onclick="event.stopPropagation();openPropertyModal('${p.id}')">‚úèÔ∏è Edit</button>
          <button class="prop-action-btn del" onclick="event.stopPropagation();confirmDeleteProp('${p.id}','${esc(p.title||'')}')">üóë Delete</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function renderPropsTable(list){
  const tbody=document.getElementById('propsTableBody');
  if(list.length===0){tbody.innerHTML=`<tr><td colspan="9"><div class="empty-state"><div class="empty-state-icon">üèóÔ∏è</div><h3>No properties</h3></div></td></tr>`;return;}
  tbody.innerHTML=list.map(p=>{
    const stCls=getPropStatusClass(p.status);
    const isPub=p.published===true;
    const date=p.createdAt?.toDate?p.createdAt.toDate().toLocaleDateString('en-IN',{day:'2-digit',month:'short'}):'Just now';
    return `<tr onclick="viewProperty('${p.id}')">
      <td><span class="td-name">${esc(p.title||'‚Äî')}</span></td>
      <td>${esc(p.type||'‚Äî')}</td>
      <td>${esc(p.location||'‚Äî')}</td>
      <td>${esc(p.area||'‚Äî')}</td>
      <td><span class="td-budget">${esc(p.price||'‚Äî')}</span></td>
      <td>${esc(p.supplierName||'‚Äî')}</td>
      <td><span class="status-pill ${stCls}">${p.status}</span></td>
      <td>
        <button class="pub-btn ${isPub?'published':'draft'}" style="width:auto;padding:0 8px" onclick="togglePublish('${p.id}',${isPub},event)">
          ${isPub?'üåê Live':'‚ö´ Draft'}
        </button>
      </td>
      <td><div class="td-actions">
        <button class="row-btn" onclick="event.stopPropagation();openPropertyModal('${p.id}')">‚úèÔ∏è</button>
        <button class="row-btn del" onclick="event.stopPropagation();confirmDeleteProp('${p.id}','${esc(p.title||'')}')">üóë</button>
      </div></td>
    </tr>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ‚Äî DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDashboard(){
  const today=new Date().toISOString().split('T')[0];
  const hot=_leads.filter(l=>l.priority==='Hot'||l.priority==='VIP').length;
  const closed=_leads.filter(l=>l.stage==='Closed').length;
  const todayFu=_followups.filter(f=>f.date===today&&f.status!=='done').length;
  const pubCount=_properties.filter(p=>p.published===true).length;
  document.getElementById('dash-total').textContent=_leads.length;
  document.getElementById('dash-props').textContent=_properties.length;
  document.getElementById('dash-published').textContent=pubCount;
  document.getElementById('dash-closed').textContent=closed;
  document.getElementById('stat-total').textContent=_leads.length;
  document.getElementById('stat-closed').textContent=closed;
  document.getElementById('stat-hot').textContent=hot;
  document.getElementById('todayFuBadge').textContent=todayFu;
  ['New','Site Visit','Negotiation','Closed'].forEach((s,i)=>{
    const key=['new','site','nego','closed'][i];
    const f=_leads.filter(l=>l.stage===s);
    const cEl=document.getElementById('pc-'+key);
    if(cEl)cEl.textContent=f.length+' lead'+(f.length!==1?'s':'');
    const lEl=document.getElementById('pc-leads-'+key);
    if(lEl)lEl.innerHTML=f.length===0?`<div style="font-size:11px;color:var(--text3);padding:8px;text-align:center">No leads</div>`:f.slice(0,4).map(l=>`<div class="lead-mini" onclick="setView('leads')"><div class="lm-name">${esc(l.name)}</div><div class="lm-prop">${esc(l.location||'')}</div><div class="lm-budget">${esc(l.budget||'‚Äî')}</div></div>`).join('');
  });
  const todayFus=_followups.filter(f=>f.date===today&&f.status!=='done');
  document.getElementById('dash-fu-subtitle').textContent=todayFu+' pending today';
  document.getElementById('dash-fu-list').innerHTML=todayFus.length===0?`<div style="padding:16px;text-align:center;font-size:12px;color:var(--text3)">üéâ No follow-ups due today!</div>`:todayFus.slice(0,4).map(f=>{const lead=_leads.find(l=>l.id===f.leadId);const name=lead?lead.name:(f.leadName||'Unknown');const init=name.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);return `<div class="fu-dash-item" onclick="setView('followups')"><div class="fu-dash-av">${init}</div><div class="fu-dash-info"><div class="fu-dash-name">${esc(name)}</div><div class="fu-dash-note">${f.type}: ${esc(f.notes||'')}</div></div><span class="fu-dash-time ${f.priority==='Urgent'?'urgent':'today'}">${f.time||'Today'}</span></div>`;}).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAVE ‚Äî LEAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function saveLead(){
  const name=document.getElementById('f-name').value.trim();
  const phone=document.getElementById('f-phone').value.trim();
  if(!name||!phone){showToast('‚ö†Ô∏è Name and phone required','error');return;}
  const data={name,phone,email:document.getElementById('f-email').value.trim(),budget:document.getElementById('f-budget').value.trim(),proptype:document.getElementById('f-proptype').value,location:document.getElementById('f-location').value.trim(),source:document.getElementById('f-source').value,stage:document.getElementById('f-stage').value||'New',priority:document.getElementById('f-priority').value||'Normal',wa:document.getElementById('f-wa').value.trim(),notes:document.getElementById('f-notes').value.trim()};
  const btn=document.getElementById('saveLeadBtn');btn.disabled=true;btn.textContent='Saving‚Ä¶';
  try{if(_editingLeadId){await updateLeadInDB(_editingLeadId,data);showToast('‚úÖ Lead updated!','success');}else{await addLeadToDB(data);showToast('‚úÖ Lead saved!','success');}closeLeadModal();}
  catch(e){showToast('‚ùå '+e.message,'error');}
  finally{btn.disabled=false;btn.innerHTML='<svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Save Lead';}
}

async function quickAddLead(){
  const name=document.getElementById('quick-name').value.trim();
  const phone=document.getElementById('quick-phone').value.trim();
  const budget=document.getElementById('quick-budget').value.trim();
  if(!name||!phone){showToast('‚ö†Ô∏è Name and phone required','error');return;}
  try{await addLeadToDB({name,phone,budget,stage:'New',priority:'Normal',email:'',location:'',source:'',notes:''});document.getElementById('quick-name').value='';document.getElementById('quick-phone').value='';document.getElementById('quick-budget').value='';showToast('‚úÖ Lead added!','success');}
  catch(e){showToast('‚ùå '+e.message,'error');}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAVE ‚Äî FOLLOW-UP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function saveFollowUp(){
  const leadId=document.getElementById('fu-leadId').value;
  const date=document.getElementById('fu-date').value;
  const notes=document.getElementById('fu-notes').value.trim();
  if(!leadId){showToast('‚ö†Ô∏è Select a lead','error');return;}
  if(!date){showToast('‚ö†Ô∏è Select a date','error');return;}
  if(!notes){showToast('‚ö†Ô∏è Add a note','error');return;}
  const lead=_leads.find(l=>l.id===leadId);
  const data={leadId,leadName:lead?lead.name:'',type:document.getElementById('fu-type').value,date,time:document.getElementById('fu-time').value,priority:document.getElementById('fu-priority').value,notes,status:'pending'};
  const btn=document.getElementById('saveFuBtn');btn.disabled=true;btn.textContent='Saving‚Ä¶';
  try{if(_editingFuId){await updateFollowUpInDB(_editingFuId,data);showToast('‚úÖ Updated!','success');}else{await addFollowUpToDB(data);showToast('‚úÖ Follow-up scheduled!','success');}closeFuModal();}
  catch(e){showToast('‚ùå '+e.message,'error');}
  finally{btn.disabled=false;btn.innerHTML='<svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Save';}
}

async function markFuDone(id){try{await updateFollowUpInDB(id,{status:'done'});showToast('‚úÖ Done!','success');}catch(e){showToast('‚ùå '+e.message,'error');}}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAVE ‚Äî PROPERTY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function saveProperty(){
  const title=document.getElementById('p-title').value.trim();
  const type=document.getElementById('p-type').value;
  const location=document.getElementById('p-location').value.trim();
  const sName=document.getElementById('p-supplier-name').value.trim();
  const sPhone=document.getElementById('p-supplier-phone').value.trim();
  if(!title){showToast('‚ö†Ô∏è Title required','error');return;}
  if(!type){showToast('‚ö†Ô∏è Select type','error');return;}
  if(!location){showToast('‚ö†Ô∏è Location required','error');return;}
  if(!sName||!sPhone){showToast('‚ö†Ô∏è Supplier name & phone required','error');return;}
  const published=document.getElementById('p-publish').checked;
  const data={title,type,location,survey:document.getElementById('p-survey').value.trim(),area:document.getElementById('p-area').value.trim(),price:document.getElementById('p-price').value.trim(),ppu:document.getElementById('p-ppu').value.trim(),zone:document.getElementById('p-zone').value,facing:document.getElementById('p-facing').value,status:document.getElementById('p-status').value||'Available',features:document.getElementById('p-features').value.trim(),description:document.getElementById('p-desc').value.trim(),supplierName:sName,supplierPhone:sPhone,supplierEmail:document.getElementById('p-supplier-email').value.trim(),supplierType:document.getElementById('p-supplier-type').value,commission:document.getElementById('p-commission').value.trim(),negotiable:document.getElementById('p-negotiable').value,titleStatus:document.getElementById('p-title-status').value,doc712:document.getElementById('p-712').value,naOrder:document.getElementById('p-na').value,legalNotes:document.getElementById('p-legal').value.trim(),published};
  const btn=document.getElementById('savePropBtn');btn.disabled=true;btn.textContent='Saving‚Ä¶';
  try{
    if(_editingPropId){await updatePropertyInDB(_editingPropId,data);showToast(published?'‚úÖ Updated & published to portal!':'‚úÖ Property updated!','success');}
    else{await addPropertyToDB(data);showToast(published?'üåê Property listed & published!':'‚úÖ Property listed!','success');}
    closePropModal();
  }catch(e){showToast('‚ùå '+e.message,'error');}
  finally{btn.disabled=false;btn.innerHTML='<svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg> Save Property';}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DELETE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function confirmDeleteLead(id,name){if(!confirm(`Delete lead "${name}"?`))return;deleteLeadFromDB(id).then(()=>showToast(`üóë Deleted`,'success')).catch(e=>showToast('‚ùå '+e.message,'error'));}
function confirmDeleteFu(id){if(!confirm('Delete this follow-up?'))return;deleteFollowUpFromDB(id).then(()=>showToast('üóë Deleted','success')).catch(e=>showToast('‚ùå '+e.message,'error'));}
function confirmDeleteProp(id,title){if(!confirm(`Delete "${title}"?`))return;deletePropertyFromDB(id).then(()=>showToast(`üóë Deleted`,'success')).catch(e=>showToast('‚ùå '+e.message,'error'));}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VIEW PROPERTY DETAIL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function viewProperty(id){
  const p=_properties.find(x=>x.id===id);if(!p)return;
  const icon=getPropIcon(p.type);const stCls=getPropStatusClass(p.status);
  const isPub=p.published===true;
  document.getElementById('propDetailTitle').textContent=p.title||'Property Details';
  document.getElementById('propDetailEditBtn').onclick=()=>{closePropDetail();openPropertyModal(id);};
  document.getElementById('propDetailBody').innerHTML=`
    <div class="prop-detail-header">
      <div class="prop-detail-icon">${icon}</div>
      <div class="prop-detail-meta">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
          <span class="status-pill ${stCls}">${p.status}</span>
          ${isPub?`<span class="status-pill" style="background:var(--teal-dim);color:var(--teal);border:1px solid rgba(45,212,191,.2)">üåê Live on Portal</span>`:`<span class="status-pill" style="background:var(--bg4);color:var(--text3)">‚ö´ Not Published</span>`}
        </div>
        <div class="prop-detail-title">${esc(p.title)}</div>
        <div class="prop-detail-loc">üìç ${esc(p.location)} ${p.survey?'¬∑ '+p.survey:''}</div>
        <div class="prop-detail-price">${esc(p.price||'Price not set')}</div>
      </div>
    </div>
    <div style="margin-bottom:14px;display:flex;gap:8px">
      <button class="pub-btn ${isPub?'published':'draft'}" style="flex:none;padding:0 16px;height:32px" onclick="togglePublish('${p.id}',${isPub},event)">
        ${isPub?'üåê Published ‚Äî Click to Unpublish':'‚ö´ Draft ‚Äî Click to Publish'}
      </button>
    </div>
    <div class="prop-info-grid">
      <div class="prop-info-item"><div class="prop-info-label">Area</div><div class="prop-info-value">${esc(p.area||'‚Äî')}</div></div>
      <div class="prop-info-item"><div class="prop-info-label">Facing</div><div class="prop-info-value">${esc(p.facing||'‚Äî')}</div></div>
      <div class="prop-info-item"><div class="prop-info-label">Negotiable</div><div class="prop-info-value" style="${p.negotiable==='Yes'?'color:var(--green)':''}">${esc(p.negotiable||'‚Äî')}</div></div>
      <div class="prop-info-item"><div class="prop-info-label">Title Status</div><div class="prop-info-value">${esc(p.titleStatus||'‚Äî')}</div></div>
      <div class="prop-info-item"><div class="prop-info-label">7/12</div><div class="prop-info-value">${esc(p.doc712||'‚Äî')}</div></div>
      <div class="prop-info-item"><div class="prop-info-label">NA Order</div><div class="prop-info-value">${esc(p.naOrder||'‚Äî')}</div></div>
    </div>
    ${p.features?`<div style="margin-bottom:12px"><div style="font-size:11px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.07em;margin-bottom:6px">Key Features</div><div class="fu-body">${esc(p.features)}</div></div>`:''}
    ${p.description?`<div style="margin-bottom:12px"><div style="font-size:11px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.07em;margin-bottom:6px">Description</div><div class="fu-body">${esc(p.description)}</div></div>`:''}
    <div style="background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:14px">
      <div style="font-size:12px;font-weight:700;color:var(--text);margin-bottom:10px">üë§ Supplier Details</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div><div style="font-size:10px;color:var(--text3);margin-bottom:3px;text-transform:uppercase;font-weight:600">Name</div><div style="font-size:13px;font-weight:600;color:var(--text)">${esc(p.supplierName||'‚Äî')}</div></div>
        <div><div style="font-size:10px;color:var(--text3);margin-bottom:3px;text-transform:uppercase;font-weight:600">Phone</div><div style="font-size:13px;font-family:'JetBrains Mono',monospace">${esc(p.supplierPhone||'‚Äî')}</div></div>
        <div><div style="font-size:10px;color:var(--text3);margin-bottom:3px;text-transform:uppercase;font-weight:600">Type</div><div style="font-size:13px">${esc(p.supplierType||'‚Äî')}</div></div>
        <div><div style="font-size:10px;color:var(--text3);margin-bottom:3px;text-transform:uppercase;font-weight:600">Commission</div><div style="font-size:13px;color:var(--gold);font-weight:600">${esc(p.commission||'‚Äî')}</div></div>
      </div>
    </div>`;
  document.getElementById('propDetailOverlay').classList.add('open');
}
function closePropDetail(){document.getElementById('propDetailOverlay').classList.remove('open');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openLeadModal(leadId){
  _editingLeadId=leadId||null;
  document.getElementById('leadModalTitle').textContent=leadId?'Edit Lead':'Add New Lead';
  ['name','phone','email','budget','proptype','location','source','stage','priority','wa','notes'].forEach(f=>{const el=document.getElementById('f-'+f);if(el)el.value='';});
  if(leadId){const lead=_leads.find(l=>l.id===leadId);if(lead)['name','phone','email','budget','proptype','location','source','stage','priority','wa','notes'].forEach(f=>{const el=document.getElementById('f-'+f);if(el&&lead[f]!==undefined)el.value=lead[f];});}
  document.getElementById('leadModalOverlay').classList.add('open');
}
function closeLeadModal(){document.getElementById('leadModalOverlay').classList.remove('open');_editingLeadId=null;}

function openFollowUpModal(fuId,presetLeadId){
  _editingFuId=fuId||null;
  document.getElementById('fuModalTitle').textContent=fuId?'Edit Follow-up':'Add Follow-up';
  const sel=document.getElementById('fu-leadId');
  sel.innerHTML='<option value="">Select a lead</option>'+_leads.map(l=>`<option value="${l.id}">${esc(l.name)} ${l.phone?'('+l.phone+')':''}</option>`).join('');
  document.getElementById('fu-date').value=new Date().toISOString().split('T')[0];
  document.getElementById('fu-time').value='10:00';
  document.getElementById('fu-notes').value='';
  if(presetLeadId)document.getElementById('fu-leadId').value=presetLeadId;
  if(fuId){const fu=_followups.find(f=>f.id===fuId);if(fu){document.getElementById('fu-leadId').value=fu.leadId||'';document.getElementById('fu-type').value=fu.type||'Call';document.getElementById('fu-date').value=fu.date||'';document.getElementById('fu-time').value=fu.time||'10:00';document.getElementById('fu-priority').value=fu.priority||'Normal';document.getElementById('fu-notes').value=fu.notes||'';}}
  document.getElementById('fuModalOverlay').classList.add('open');
}
function closeFuModal(){document.getElementById('fuModalOverlay').classList.remove('open');_editingFuId=null;}

function openPropertyModal(propId){
  _editingPropId=propId||null;
  document.getElementById('propModalTitle').textContent=propId?'Edit Property':'Add Property';
  const fields=['title','type','location','survey','area','price','ppu','zone','facing','status','features','desc','supplier-name','supplier-phone','supplier-email','supplier-type','commission','negotiable','title-status','712','na','legal'];
  fields.forEach(f=>{const el=document.getElementById('p-'+f);if(el)el.value='';});
  document.getElementById('p-status').value='Available';
  document.getElementById('p-negotiable').value='Yes';
  document.getElementById('p-supplier-type').value='Direct Owner';
  document.getElementById('p-publish').checked=false;
  if(propId){
    const p=_properties.find(x=>x.id===propId);
    if(p){
      const map={title:'title',type:'type',location:'location',survey:'survey',area:'area',price:'price',ppu:'ppu',zone:'zone',facing:'facing',status:'status',features:'features',description:'desc',supplierName:'supplier-name',supplierPhone:'supplier-phone',supplierEmail:'supplier-email',supplierType:'supplier-type',commission:'commission',negotiable:'negotiable',titleStatus:'title-status',doc712:'712',naOrder:'na',legalNotes:'legal'};
      Object.entries(map).forEach(([key,fId])=>{const el=document.getElementById('p-'+fId);if(el&&p[key]!==undefined)el.value=p[key];});
      document.getElementById('p-publish').checked=p.published===true;
    }
  }
  document.getElementById('propModalOverlay').classList.add('open');
}
function closePropModal(){document.getElementById('propModalOverlay').classList.remove('open');_editingPropId=null;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VIEW TOGGLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setPropView(mode){
  _propViewMode=mode;
  document.getElementById('propsGridView').style.display=mode==='grid'?'block':'none';
  document.getElementById('propsTableView').style.display=mode==='table'?'block':'none';
  document.getElementById('vt-grid').classList.toggle('active',mode==='grid');
  document.getElementById('vt-table').classList.toggle('active',mode==='table');
  renderProperties();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SEARCH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handleSearch(val){
  if(!val.trim()){renderLeads();return;}
  const q=val.toLowerCase();
  const filtered=_leads.filter(l=>(l.name||'').toLowerCase().includes(q)||(l.phone||'').includes(q)||(l.location||'').toLowerCase().includes(q));
  const orig=_leads;_leads=filtered;renderLeads();_leads=orig;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setView(name){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('view-'+name).classList.add('active');
  const ni=document.getElementById('nav-'+name);if(ni)ni.classList.add('active');
}

function updateNavCounts(){
  const hot=_leads.filter(l=>l.priority==='Hot'||l.priority==='VIP').length;
  const today=new Date().toISOString().split('T')[0];
  const todayFu=_followups.filter(f=>f.date===today&&f.status!=='done').length;
  document.getElementById('nav-leads-count').textContent=hot>0?hot+' hot':_leads.length;
  document.getElementById('nav-fu-count').textContent=todayFu;
  document.getElementById('todayFuBadge').textContent=todayFu;
  document.getElementById('nav-props-count').textContent=_properties.length;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FILTER CHIPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById('leadsToolbar').addEventListener('click',e=>{const chip=e.target.closest('.filter-chip');if(!chip)return;document.querySelectorAll('#leadsToolbar .filter-chip').forEach(c=>c.classList.remove('active'));chip.classList.add('active');renderLeads(chip.dataset.filter);});
document.getElementById('propsToolbar').addEventListener('click',e=>{const chip=e.target.closest('.filter-chip');if(!chip)return;document.querySelectorAll('#propsToolbar .filter-chip').forEach(c=>c.classList.remove('active'));chip.classList.add('active');renderProperties(chip.dataset.pfilter);});
document.querySelectorAll('.fu-type-item').forEach(item=>item.addEventListener('click',()=>{document.querySelectorAll('.fu-type-item').forEach(i=>i.classList.remove('active'));item.classList.add('active');renderFollowUps(item.dataset.type);}));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MINI CALENDAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildMiniCal(){
  const now=new Date();
  document.getElementById('calMonth').textContent=now.toLocaleString('default',{month:'long',year:'numeric'});
  const firstDay=new Date(now.getFullYear(),now.getMonth(),1).getDay();
  const days=new Date(now.getFullYear(),now.getMonth()+1,0).getDate();
  const today=now.getDate();
  let html=['S','M','T','W','T','F','S'].map(d=>`<div class="mcg-day-name">${d}</div>`).join('');
  for(let i=0;i<firstDay;i++)html+='<div></div>';
  for(let d=1;d<=days;d++)html+=`<div class="mcg-day${d===today?' today':''}">${d}</div>`;
  document.getElementById('miniCal').innerHTML=`<div class="mini-cal-grid">${html}</div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setDbStatus(ok,msg){const dot=document.getElementById('dbDot');const txt=document.getElementById('dbStatusText');dot.className='db-dot '+(ok?'connected':'error');txt.textContent=msg;}
function updateDate(){const now=new Date();const h=now.getHours();const g=h<12?'Good morning':h<17?'Good afternoon':'Good evening';document.getElementById('dashGreeting').textContent=g+' ‚òÄÔ∏è';document.getElementById('dashDate').textContent=now.toLocaleDateString('en-IN',{weekday:'long',day:'numeric',month:'long',year:'numeric'})+' ¬∑ Real Estate CRM';}
function formatDate(s){return new Date(s).toLocaleDateString('en-IN',{weekday:'long',day:'2-digit',month:'long'});}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
let _toastTimer;
function showToast(msg,type='success'){const t=document.getElementById('toast');const icon=type==='error'?'‚ùå':type==='info'?'üí°':'‚úÖ';document.getElementById('toastIcon').textContent=icon;document.getElementById('toastMsg').textContent=msg;t.className='toast show '+type;clearTimeout(_toastTimer);_toastTimer=setTimeout(()=>t.classList.remove('show'),3500);}

window.addEventListener('load',()=>{updateDate();buildMiniCal();if(window._dbReady&&window._db){setDbStatus(true,'Connected');_dbConnected=true;loadLeadsFromDB();loadFollowUpsFromDB();loadPropertiesFromDB();}});
</script>
</body>
</html>
