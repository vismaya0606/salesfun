<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SalesFun ‚Äî Property Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, getDocs, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAz-44QWWH4lcXu9I7Xs56RCsjSbmSHNuo",
    authDomain: "fir-config-9023d.firebaseapp.com",
    projectId: "fir-config-9023d",
    storageBucket: "fir-config-9023d.firebasestorage.app",
    messagingSenderId: "178665965729",
    appId: "1:178665965729:web:57fcb0f607a1420c8e08e0"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window._db = db;
  window._firebase = { collection, getDocs, query, where, orderBy, onSnapshot };

  document.addEventListener('DOMContentLoaded', () => {
    loadPublishedProperties();
  });
</script>

<style>
:root {
  --bg: #0a0908;
  --bg2: #111009;
  --bg3: #1a1712;
  --bg4: #22201a;
  --border: rgba(210,185,120,0.09);
  --border2: rgba(210,185,120,0.2);
  --gold: #c9a84c;
  --gold2: #e8c870;
  --gold-dim: rgba(201,168,76,0.1);
  --gold-glow: rgba(201,168,76,0.2);
  --text: #ede8d8;
  --text2: #8a8070;
  --text3: #4a4535;
  --green: #4dbe85;
  --green-dim: rgba(77,190,133,0.1);
  --orange: #e0884a;
  --orange-dim: rgba(224,136,74,0.1);
  --red: #d95050;
  --teal: #2cc4af;
  --teal-dim: rgba(44,196,175,0.1);
}
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body {
  font-family: 'Outfit', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

/* ‚îÄ‚îÄ BACKGROUND TEXTURE ‚îÄ‚îÄ */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse 80% 60% at 15% 10%, rgba(201,168,76,0.04) 0%, transparent 60%),
    radial-gradient(ellipse 60% 50% at 85% 90%, rgba(44,196,175,0.03) 0%, transparent 55%);
  pointer-events: none;
  z-index: 0;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(10,9,8,0.92);
  backdrop-filter: blur(18px);
  border-bottom: 1px solid var(--border);
  padding: 0 40px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
}
.logo-icon {
  width: 34px; height: 34px;
  background: linear-gradient(135deg, var(--gold), var(--gold2));
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Playfair Display', serif;
  font-weight: 900; font-size: 16px;
  color: #0a0908;
}
.logo-text {
  font-family: 'Playfair Display', serif;
  font-size: 20px;
  font-weight: 700;
  color: var(--gold2);
  letter-spacing: .02em;
}
.logo-tagline {
  font-size: 11px;
  color: var(--text3);
  letter-spacing: .08em;
  text-transform: uppercase;
  margin-left: 4px;
}
.header-right {
  display: flex;
  align-items: center;
  gap: 14px;
}
.live-badge {
  display: flex; align-items: center; gap: 6px;
  background: var(--green-dim);
  border: 1px solid rgba(77,190,133,.2);
  border-radius: 20px;
  padding: 4px 12px;
  font-size: 11px;
  font-weight: 600;
  color: var(--green);
}
.live-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--green);
  box-shadow: 0 0 8px var(--green);
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: .4; }
}
.header-cta {
  padding: 0 18px; height: 36px;
  background: var(--gold);
  border: none;
  color: #0a0908;
  font-family: 'Outfit', sans-serif;
  font-size: 13px;
  font-weight: 700;
  border-radius: 8px;
  cursor: pointer;
  text-decoration: none;
  display: flex; align-items: center; gap: 6px;
  transition: all .2s;
}
.header-cta:hover { background: var(--gold2); transform: translateY(-1px); }

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero {
  position: relative;
  padding: 80px 40px 60px;
  text-align: center;
  z-index: 1;
  overflow: hidden;
}
.hero::before {
  content: '';
  position: absolute;
  top: -100px; left: 50%;
  transform: translateX(-50%);
  width: 600px; height: 400px;
  background: radial-gradient(ellipse, rgba(201,168,76,0.08) 0%, transparent 70%);
  pointer-events: none;
}
.hero-eyebrow {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--gold-dim);
  border: 1px solid rgba(201,168,76,.2);
  border-radius: 20px;
  padding: 5px 14px;
  font-size: 11px;
  font-weight: 600;
  color: var(--gold);
  letter-spacing: .1em;
  text-transform: uppercase;
  margin-bottom: 24px;
}
.hero h1 {
  font-family: 'Playfair Display', serif;
  font-size: clamp(36px, 5vw, 62px);
  font-weight: 900;
  line-height: 1.1;
  color: var(--text);
  margin-bottom: 18px;
}
.hero h1 em {
  font-style: italic;
  color: var(--gold2);
}
.hero-sub {
  font-size: 16px;
  color: var(--text2);
  max-width: 560px;
  margin: 0 auto 40px;
  line-height: 1.7;
}
.hero-stats {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 40px;
  flex-wrap: wrap;
}
.hero-stat-val {
  font-family: 'Playfair Display', serif;
  font-size: 28px;
  font-weight: 700;
  color: var(--gold);
}
.hero-stat-lbl {
  font-size: 12px;
  color: var(--text3);
  margin-top: 2px;
}
.hero-divider {
  width: 1px; height: 36px;
  background: var(--border2);
}

/* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
.filters-bar {
  position: sticky;
  top: 64px;
  z-index: 90;
  background: rgba(10,9,8,0.9);
  backdrop-filter: blur(14px);
  border-bottom: 1px solid var(--border);
  padding: 12px 40px;
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}
.search-wrap {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 0 12px;
  height: 36px;
  min-width: 240px;
  flex: 1;
  max-width: 360px;
}
.search-wrap input {
  background: none; border: none; outline: none;
  color: var(--text);
  font-family: 'Outfit', sans-serif;
  font-size: 13px;
  width: 100%;
}
.search-wrap input::placeholder { color: var(--text3); }
.filter-chip {
  padding: 5px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  background: var(--bg3);
  border: 1px solid var(--border);
  color: var(--text2);
  cursor: pointer;
  transition: all .15s;
  white-space: nowrap;
}
.filter-chip:hover { border-color: var(--border2); color: var(--text); }
.filter-chip.active { background: var(--gold-dim); border-color: rgba(201,168,76,.3); color: var(--gold); }
.sort-select {
  margin-left: auto;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text2);
  font-family: 'Outfit', sans-serif;
  font-size: 12px;
  padding: 5px 10px;
  outline: none;
  cursor: pointer;
}
.sort-select option { background: var(--bg3); }
.result-count {
  font-size: 12px;
  color: var(--text3);
  white-space: nowrap;
}

/* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
.grid-container {
  padding: 32px 40px 60px;
  position: relative;
  z-index: 1;
}
.prop-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 20px;
}

/* ‚îÄ‚îÄ PROPERTY CARD ‚îÄ‚îÄ */
.prop-card {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 14px;
  overflow: hidden;
  cursor: pointer;
  transition: all .25s cubic-bezier(.4,0,.2,1);
  animation: fadeUp .5s ease forwards;
  opacity: 0;
}
.prop-card:hover {
  border-color: var(--border2);
  transform: translateY(-4px);
  box-shadow: 0 16px 48px rgba(0,0,0,.5), 0 0 0 1px rgba(201,168,76,.08);
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

.card-thumb {
  height: 180px;
  background: var(--bg3);
  position: relative;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}
.card-thumb-bg {
  position: absolute;
  inset: 0;
  opacity: .08;
}
.card-thumb-icon {
  font-size: 52px;
  position: relative;
  z-index: 1;
  filter: drop-shadow(0 4px 20px rgba(201,168,76,.3));
}
.card-thumb-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, rgba(10,9,8,.9) 0%, rgba(10,9,8,.1) 60%, transparent 100%);
  z-index: 2;
}
.card-badges {
  position: absolute;
  top: 12px; left: 12px;
  z-index: 3;
  display: flex; gap: 6px;
}
.card-price {
  position: absolute;
  bottom: 12px; right: 12px;
  z-index: 3;
  font-family: 'Playfair Display', serif;
  font-size: 17px;
  font-weight: 700;
  color: var(--gold2);
}
.card-price small {
  font-family: 'Outfit', sans-serif;
  font-size: 10px;
  color: var(--text2);
  font-weight: 400;
  display: block;
  text-align: right;
}

.card-body { padding: 16px; }
.card-title {
  font-family: 'Playfair Display', serif;
  font-size: 16px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.card-loc {
  font-size: 12px;
  color: var(--text3);
  display: flex; align-items: center; gap: 4px;
  margin-bottom: 12px;
}
.card-metas {
  display: flex; gap: 6px; flex-wrap: wrap;
  margin-bottom: 14px;
}
.card-meta {
  display: flex; align-items: center; gap: 4px;
  font-size: 11px;
  color: var(--text2);
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 5px;
  padding: 3px 8px;
}
.card-footer {
  display: flex; gap: 8px;
  padding-top: 12px;
  border-top: 1px solid var(--border);
}
.card-btn {
  flex: 1; height: 34px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--bg3);
  color: var(--text2);
  font-family: 'Outfit', sans-serif;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all .15s;
  display: flex; align-items: center; justify-content: center; gap: 5px;
}
.card-btn:hover { border-color: var(--border2); color: var(--text); }
.card-btn.primary {
  background: var(--gold-dim);
  border-color: rgba(201,168,76,.3);
  color: var(--gold);
}
.card-btn.primary:hover { background: var(--gold-glow); }

/* ‚îÄ‚îÄ STATUS PILLS ‚îÄ‚îÄ */
.pill {
  display: inline-flex; align-items: center; gap: 4px;
  font-size: 10px; font-weight: 600;
  padding: 3px 9px; border-radius: 20px;
}
.pill-avail { background: var(--green-dim); color: var(--green); border: 1px solid rgba(77,190,133,.2); }
.pill-nego { background: var(--gold-dim); color: var(--gold); border: 1px solid rgba(201,168,76,.2); }
.pill-hold { background: var(--orange-dim); color: var(--orange); border: 1px solid rgba(224,136,74,.2); }
.pill-sold { background: rgba(80,70,55,.3); color: var(--text3); border: 1px solid var(--border); }
.pill-type { background: rgba(80,70,55,.2); color: var(--text2); border: 1px solid var(--border); }

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.8);
  z-index: 1000;
  display: none;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(6px);
  padding: 20px;
}
.modal-overlay.open { display: flex; }
.modal {
  background: var(--bg2);
  border: 1px solid var(--border2);
  border-radius: 18px;
  width: 660px;
  max-width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  animation: fadeUp .3s ease;
}
.modal::-webkit-scrollbar { width: 4px; }
.modal::-webkit-scrollbar-thumb { background: var(--bg4); border-radius: 2px; }
.modal-header {
  padding: 20px 22px 16px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: flex-start; justify-content: space-between;
  position: sticky; top: 0;
  background: var(--bg2);
  z-index: 1;
}
.modal-close {
  width: 30px; height: 30px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 7px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  color: var(--text2);
  font-size: 16px;
  transition: all .15s;
  flex-shrink: 0;
  margin-top: 2px;
}
.modal-close:hover { border-color: var(--border2); color: var(--text); }
.modal-body { padding: 20px 22px; }

.m-hero {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 18px;
  margin-bottom: 18px;
  display: flex; gap: 14px;
}
.m-icon {
  width: 60px; height: 60px;
  border-radius: 14px;
  background: var(--gold-dim);
  border: 1px solid rgba(201,168,76,.2);
  display: flex; align-items: center; justify-content: center;
  font-size: 28px;
  flex-shrink: 0;
}
.m-meta { flex: 1; }
.m-badges { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 8px; }
.m-title {
  font-family: 'Playfair Display', serif;
  font-size: 20px; font-weight: 700; color: var(--text);
  margin-bottom: 4px;
}
.m-loc { font-size: 13px; color: var(--text3); }
.m-price {
  font-family: 'Playfair Display', serif;
  font-size: 24px; font-weight: 700;
  color: var(--gold);
  margin-top: 6px;
}
.m-ppu { font-size: 12px; color: var(--text2); font-family: 'Outfit', sans-serif; }

.info-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 16px;
}
.info-item {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 12px;
}
.info-label { font-size: 10px; color: var(--text3); font-weight: 600; text-transform: uppercase; letter-spacing: .07em; margin-bottom: 4px; }
.info-value { font-size: 13px; font-weight: 600; color: var(--text); }

.section-label {
  font-size: 11px; font-weight: 700;
  color: var(--text3);
  text-transform: uppercase; letter-spacing: .09em;
  margin-bottom: 8px;
  display: flex; align-items: center; gap: 6px;
}
.text-block {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 14px;
  font-size: 13px; color: var(--text2);
  line-height: 1.7;
  margin-bottom: 14px;
}

.contact-box {
  background: linear-gradient(135deg, var(--bg3), var(--bg4));
  border: 1px solid var(--border2);
  border-radius: 12px;
  padding: 16px;
  margin-top: 16px;
}
.contact-box h4 {
  font-size: 13px; font-weight: 700;
  color: var(--text);
  margin-bottom: 12px;
  display: flex; align-items: center; gap: 6px;
}
.contact-btns { display: flex; gap: 8px; flex-wrap: wrap; }
.contact-btn {
  flex: 1; min-width: 120px; height: 38px;
  border-radius: 9px;
  font-family: 'Outfit', sans-serif;
  font-size: 13px; font-weight: 600;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center; gap: 6px;
  text-decoration: none;
  transition: all .2s;
}
.contact-btn.call {
  background: var(--green-dim);
  border: 1px solid rgba(77,190,133,.3);
  color: var(--green);
}
.contact-btn.call:hover { background: rgba(77,190,133,.2); }
.contact-btn.wa {
  background: rgba(37,211,102,.1);
  border: 1px solid rgba(37,211,102,.25);
  color: #25d366;
}
.contact-btn.wa:hover { background: rgba(37,211,102,.18); }
.contact-btn.gold {
  background: var(--gold);
  border: none;
  color: #0a0908;
}
.contact-btn.gold:hover { background: var(--gold2); transform: translateY(-1px); }

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.empty-state {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 100px 20px;
  text-align: center;
  grid-column: 1/-1;
}
.empty-icon { font-size: 60px; opacity: .3; margin-bottom: 16px; }
.empty-state h3 { font-family: 'Playfair Display', serif; font-size: 22px; color: var(--text2); margin-bottom: 8px; }
.empty-state p { font-size: 14px; color: var(--text3); max-width: 340px; line-height: 1.6; }

/* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
.loading-card {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 14px;
  overflow: hidden;
  animation: shimmer 1.5s infinite;
}
@keyframes shimmer {
  0%, 100% { opacity: .4; }
  50% { opacity: .7; }
}
.loading-thumb { height: 180px; background: var(--bg3); }
.loading-body { padding: 16px; display: flex; flex-direction: column; gap: 8px; }
.loading-line { height: 12px; border-radius: 4px; background: var(--bg4); }

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
.footer {
  background: var(--bg2);
  border-top: 1px solid var(--border);
  padding: 32px 40px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 16px;
  position: relative; z-index: 1;
}
.footer-left { display: flex; align-items: center; gap: 10px; }
.footer-brand {
  font-family: 'Playfair Display', serif;
  font-size: 16px; font-weight: 700; color: var(--gold);
}
.footer-sub { font-size: 11px; color: var(--text3); }
.footer-right { font-size: 12px; color: var(--text3); }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed; bottom: 24px; right: 24px;
  background: var(--bg2);
  border: 1px solid rgba(201,168,76,.3);
  border-radius: 10px;
  padding: 12px 16px;
  z-index: 9999;
  display: flex; align-items: center; gap: 10px;
  font-size: 13px; color: var(--text);
  transform: translateY(20px); opacity: 0;
  transition: all .3s;
  pointer-events: none;
  min-width: 200px;
  box-shadow: 0 8px 30px rgba(0,0,0,.5);
}
.toast.show { transform: translateY(0); opacity: 1; }

@media (max-width: 768px) {
  .header, .filters-bar, .grid-container, .footer { padding-left: 20px; padding-right: 20px; }
  .hero { padding: 50px 20px 40px; }
  .prop-grid { grid-template-columns: 1fr; }
  .info-grid { grid-template-columns: repeat(2,1fr); }
  .hero-stats { gap: 24px; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <a class="logo" href="#">
    <div class="logo-icon">P</div>
    <span class="logo-text">SalesFun</span>
    <span class="logo-tagline">Property Portal</span>
  </a>
  <div class="header-right">
    <div class="live-badge">
      <div class="live-dot"></div>
      Live Listings
    </div>
    <a href="#listings" class="header-cta">
      Browse Properties ‚Üí
    </a>
  </div>
</header>

<!-- HERO -->
<section class="hero">
  <div class="hero-eyebrow">
    üèÜ Premium Real Estate Listings
  </div>
  <h1>Find Your <em>Perfect</em><br>Property Today</h1>
  <p class="hero-sub">Explore our curated selection of agricultural land, residential plots, and commercial properties ‚Äî updated live from our inventory.</p>
  <div class="hero-stats">
    <div>
      <div class="hero-stat-val" id="hero-avail">‚Äî</div>
      <div class="hero-stat-lbl">Available Now</div>
    </div>
    <div class="hero-divider"></div>
    <div>
      <div class="hero-stat-val" id="hero-total">‚Äî</div>
      <div class="hero-stat-lbl">Total Listings</div>
    </div>
    <div class="hero-divider"></div>
    <div>
      <div class="hero-stat-val" id="hero-types">‚Äî</div>
      <div class="hero-stat-lbl">Property Types</div>
    </div>
  </div>
</section>

<!-- FILTERS -->
<div class="filters-bar" id="listings">
  <div class="search-wrap">
    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="color:var(--text3);flex-shrink:0"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <input type="text" placeholder="Search by name, location, type‚Ä¶" id="searchInput" oninput="filterProperties()">
  </div>
  <div class="filter-chip active" data-f="all" onclick="setFilter(this,'all')">All</div>
  <div class="filter-chip" data-f="Available" onclick="setFilter(this,'Available')">üü¢ Available</div>
  <div class="filter-chip" data-f="Negotiation" onclick="setFilter(this,'Negotiation')">üü° Negotiation</div>
  <div class="filter-chip" data-f="On Hold" onclick="setFilter(this,'On Hold')">üü† On Hold</div>
  <select class="sort-select" id="sortSelect" onchange="filterProperties()">
    <option value="new">Newest First</option>
    <option value="price-asc">Price: Low ‚Üí High</option>
    <option value="price-desc">Price: High ‚Üí Low</option>
    <option value="alpha">A ‚Üí Z</option>
  </select>
  <span class="result-count" id="resultCount">Loading‚Ä¶</span>
</div>

<!-- GRID -->
<main class="grid-container">
  <div class="prop-grid" id="propGrid">
    <!-- Loading skeletons -->
    ${[1,2,3,4,5,6].map(()=>`
    <div class="loading-card">
      <div class="loading-thumb"></div>
      <div class="loading-body">
        <div class="loading-line" style="width:70%"></div>
        <div class="loading-line" style="width:45%"></div>
        <div class="loading-line" style="width:55%"></div>
      </div>
    </div>`).join('')}
  </div>
</main>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-left">
    <div class="logo-icon">P</div>
    <div>
      <div class="footer-brand">SalesFun Properties</div>
      <div class="footer-sub">Powered by SalesFun CRM ¬∑ Live data</div>
    </div>
  </div>
  <div class="footer-right">¬© 2026 SalesFun. All rights reserved.</div>
</footer>

<!-- PROPERTY DETAIL MODAL -->
<div class="modal-overlay" id="propModal" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div style="font-size:11px;color:var(--text3);font-weight:600;letter-spacing:.08em;text-transform:uppercase;margin-bottom:4px">Property Details</div>
        <div id="modalTitle" style="font-family:'Playfair Display',serif;font-size:20px;font-weight:700">‚Äî</div>
      </div>
      <div class="modal-close" onclick="closeModal()">‚úï</div>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"><span id="toastMsg">‚úÖ Done!</span></div>

<script>
// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let _allProperties = [];
let _currentFilter = 'all';

// ‚îÄ‚îÄ LOAD FROM FIREBASE ‚îÄ‚îÄ
function loadPublishedProperties() {
  const { collection, onSnapshot, orderBy, query, where } = window._firebase;

  // Listen for published properties in real-time
  const q = query(
    collection(window._db, 'properties'),
    where('published', '==', true),
    orderBy('createdAt', 'desc')
  );

  onSnapshot(q, (snapshot) => {
    _allProperties = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
    updateHeroStats();
    filterProperties();
  }, (err) => {
    console.warn('Filtered query failed, trying without filter:', err.message);
    // Fallback: load all and filter client-side (in case index not set up)
    const qAll = query(collection(window._db, 'properties'), orderBy('createdAt', 'desc'));
    onSnapshot(qAll, (snapshot) => {
      _allProperties = snapshot.docs
        .map(d => ({ id: d.id, ...d.data() }))
        .filter(p => p.published === true);
      updateHeroStats();
      filterProperties();
    });
  });
}

// ‚îÄ‚îÄ HERO STATS ‚îÄ‚îÄ
function updateHeroStats() {
  const avail = _allProperties.filter(p => p.status === 'Available').length;
  const types = [...new Set(_allProperties.map(p => p.type).filter(Boolean))].length;
  document.getElementById('hero-avail').textContent = avail;
  document.getElementById('hero-total').textContent = _allProperties.length;
  document.getElementById('hero-types').textContent = types;
}

// ‚îÄ‚îÄ FILTER & RENDER ‚îÄ‚îÄ
function setFilter(el, val) {
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  _currentFilter = val;
  filterProperties();
}

function filterProperties() {
  const q = document.getElementById('searchInput').value.toLowerCase();
  const sort = document.getElementById('sortSelect').value;

  let list = _allProperties;
  if (_currentFilter !== 'all') list = list.filter(p => p.status === _currentFilter);
  if (q) list = list.filter(p =>
    (p.title||'').toLowerCase().includes(q) ||
    (p.location||'').toLowerCase().includes(q) ||
    (p.type||'').toLowerCase().includes(q) ||
    (p.price||'').toLowerCase().includes(q)
  );

  // Sort
  if (sort === 'alpha') list = [...list].sort((a,b) => (a.title||'').localeCompare(b.title||''));
  else if (sort === 'price-asc') list = [...list].sort((a,b) => parsePriceNum(a.price) - parsePriceNum(b.price));
  else if (sort === 'price-desc') list = [...list].sort((a,b) => parsePriceNum(b.price) - parsePriceNum(a.price));

  document.getElementById('resultCount').textContent = `${list.length} listing${list.length!==1?'s':''}`;
  renderGrid(list);
}

function parsePriceNum(price) {
  if (!price) return 0;
  const m = price.replace(/[‚Çπ,\s]/g,'').match(/[\d.]+/);
  return m ? parseFloat(m[0]) : 0;
}

function renderGrid(list) {
  const grid = document.getElementById('propGrid');
  if (list.length === 0) {
    grid.innerHTML = `<div class="empty-state">
      <div class="empty-icon">üèóÔ∏è</div>
      <h3>No properties found</h3>
      <p>Try adjusting your filters or check back soon ‚Äî new listings are added regularly.</p>
    </div>`;
    return;
  }
  grid.innerHTML = list.map((p, i) => renderCard(p, i)).join('');
}

function getIcon(type) {
  const m = {'Agricultural Land':'üåæ','Farm Land':'üåª','Residential Plot':'üè°','Commercial Plot':'üè¢','Apartment':'üè¨','Villa / Bungalow':'üè†','Industrial Land':'üè≠','Warehouse / Godown':'üì¶','Office Space':'üíº','Mixed Use':'üèôÔ∏è'};
  return m[type] || 'üèóÔ∏è';
}
function getPillClass(status) {
  return {Available:'pill-avail',Negotiation:'pill-nego','On Hold':'pill-hold',Sold:'pill-sold'}[status] || 'pill-avail';
}
function esc(s) { return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

function renderCard(p, i) {
  const icon = getIcon(p.type);
  const pillCls = getPillClass(p.status);
  return `<div class="prop-card" style="animation-delay:${i*0.06}s" onclick="openModal('${p.id}')">
    <div class="card-thumb">
      <div class="card-thumb-bg" style="background:radial-gradient(circle at 30% 40%,var(--gold),transparent 65%)"></div>
      <div class="card-thumb-icon">${icon}</div>
      <div class="card-thumb-overlay"></div>
      <div class="card-badges">
        <span class="pill ${pillCls}">${p.status||'Available'}</span>
        ${p.zone?`<span class="pill pill-type">${esc(p.zone)}</span>`:''}
      </div>
      <div class="card-price">
        ${esc(p.price||'Price on request')}
        ${p.ppu?`<small>${esc(p.ppu)}</small>`:''}
      </div>
    </div>
    <div class="card-body">
      <div class="card-title" title="${esc(p.title)}">${esc(p.title||'Untitled')}</div>
      <div class="card-loc">
        <svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="color:var(--text3);flex-shrink:0"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
        ${esc(p.location||'Location TBD')}
      </div>
      <div class="card-metas">
        ${p.type?`<div class="card-meta">üè∑Ô∏è ${esc(p.type)}</div>`:''}
        ${p.area?`<div class="card-meta">üìê ${esc(p.area)}</div>`:''}
        ${p.facing?`<div class="card-meta">üß≠ ${esc(p.facing)}</div>`:''}
        ${p.negotiable==='Yes'?`<div class="card-meta" style="color:var(--green)">‚úì Negotiable</div>`:''}
      </div>
      <div class="card-footer">
        <button class="card-btn primary" onclick="event.stopPropagation();openModal('${p.id}')">View Details</button>
        <button class="card-btn" onclick="event.stopPropagation();contactAgent('${esc(p.supplierPhone||'')}','${esc(p.title||'')}')">üìû Enquire</button>
      </div>
    </div>
  </div>`;
}

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ
function openModal(id) {
  const p = _allProperties.find(x => x.id === id);
  if (!p) return;
  const icon = getIcon(p.type);
  const pillCls = getPillClass(p.status);
  document.getElementById('modalTitle').textContent = p.title || 'Property Details';
  document.getElementById('modalBody').innerHTML = `
    <div class="m-hero">
      <div class="m-icon">${icon}</div>
      <div class="m-meta">
        <div class="m-badges">
          <span class="pill ${pillCls}">${p.status||'Available'}</span>
          ${p.type?`<span class="pill pill-type">${esc(p.type)}</span>`:''}
          ${p.zone?`<span class="pill" style="background:var(--teal-dim);color:var(--teal);border:1px solid rgba(44,196,175,.2)">${esc(p.zone)}</span>`:''}
        </div>
        <div class="m-title">${esc(p.title)}</div>
        <div class="m-loc">üìç ${esc(p.location||'‚Äî')} ${p.survey?'¬∑ '+esc(p.survey):''}</div>
        <div class="m-price">${esc(p.price||'Price on request')}</div>
        ${p.ppu?`<div class="m-ppu">${esc(p.ppu)}</div>`:''}
      </div>
    </div>

    <div class="info-grid">
      <div class="info-item"><div class="info-label">Area / Size</div><div class="info-value">${esc(p.area||'‚Äî')}</div></div>
      <div class="info-item"><div class="info-label">Facing</div><div class="info-value">${esc(p.facing||'‚Äî')}</div></div>
      <div class="info-item"><div class="info-label">Negotiable</div><div class="info-value" style="${p.negotiable==='Yes'?'color:var(--green)':''}">${esc(p.negotiable||'‚Äî')}</div></div>
      <div class="info-item"><div class="info-label">Title Status</div><div class="info-value">${esc(p.titleStatus||'‚Äî')}</div></div>
      <div class="info-item"><div class="info-label">7/12 Extract</div><div class="info-value">${esc(p.doc712||'‚Äî')}</div></div>
      <div class="info-item"><div class="info-label">NA Order</div><div class="info-value">${esc(p.naOrder||'‚Äî')}</div></div>
    </div>

    ${p.features?`<div class="section-label">‚ú® Key Features</div><div class="text-block">${esc(p.features)}</div>`:''}
    ${p.description?`<div class="section-label">üìã Description</div><div class="text-block">${esc(p.description)}</div>`:''}

    <div class="contact-box">
      <h4>ü§ù Interested in this property?</h4>
      <div class="contact-btns">
        ${p.supplierPhone?`
        <a class="contact-btn call" href="tel:${esc(p.supplierPhone)}">
          üìû Call Agent
        </a>
        <a class="contact-btn wa" href="https://wa.me/${p.supplierPhone.replace(/[^0-9]/g,'')}?text=Hi, I'm interested in: ${encodeURIComponent(p.title||'Property')}" target="_blank">
          üí¨ WhatsApp
        </a>
        `:`<span style="font-size:12px;color:var(--text3)">Contact information available upon request.</span>`}
        <button class="contact-btn gold" onclick="showToastMsg('‚úÖ Enquiry sent! Agent will contact you soon.')">Send Enquiry ‚úâÔ∏è</button>
      </div>
    </div>
  `;
  document.getElementById('propModal').classList.add('open');
}
function closeModal() { document.getElementById('propModal').classList.remove('open'); }

function contactAgent(phone, title) {
  if (phone) {
    const msg = encodeURIComponent(`Hi, I'm interested in the property: ${title}. Please share more details.`);
    window.open(`https://wa.me/${phone.replace(/[^0-9]/g,'')}?text=${msg}`, '_blank');
  } else {
    showToastMsg('üìû Contact details available on the property page.');
  }
}

let _toastTimer;
function showToastMsg(msg) {
  const t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  t.classList.add('show');
  clearTimeout(_toastTimer);
  _toastTimer = setTimeout(() => t.classList.remove('show'), 3500);
}
</script>
</body>
</html>
